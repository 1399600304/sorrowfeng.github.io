<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Qt学习笔记 | ľ��ɿ�</title><meta name="keywords" content="学习笔记,Qt"><meta name="author" content="��ɽ��"><meta name="copyright" content="��ɽ��"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="main函数模板#include &lt;QApplication&gt;int main(int argc, char *argv[])&amp;#123;    QApplication a(argc, argv);    return a.exec();&amp;#125;  方便调试时查看打印信息的方式#include &lt;QDebug&gt;&#x2F;&#x2F;方便调试时的打印输出#define cout qDeb">
<meta property="og:type" content="article">
<meta property="og:title" content="Qt学习笔记">
<meta property="og:url" content="http://example.com/Qt-note/index.html">
<meta property="og:site_name" content="ľ��ɿ�">
<meta property="og:description" content="main函数模板#include &lt;QApplication&gt;int main(int argc, char *argv[])&amp;#123;    QApplication a(argc, argv);    return a.exec();&amp;#125;  方便调试时查看打印信息的方式#include &lt;QDebug&gt;&#x2F;&#x2F;方便调试时的打印输出#define cout qDeb">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2020/07/19/UWJDW8.jpg">
<meta property="article:published_time" content="2020-07-19T09:38:50.000Z">
<meta property="article:modified_time" content="2020-10-20T13:27:12.610Z">
<meta property="article:author" content="��ɽ��">
<meta property="article:tag" content="学习笔记">
<meta property="article:tag" content="Qt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2020/07/19/UWJDW8.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/Qt-note/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Qt学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-10-20 21:27:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2020/07/19/UWJDW8.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ľ��ɿ�</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Qt学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-07-19T09:38:50.000Z" title="发表于 2020-07-19 17:38:50">2020-07-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-10-20T13:27:12.610Z" title="更新于 2020-10-20 21:27:12">2020-10-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Qt学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="main函数模板"><a href="#main函数模板" class="headerlink" title="main函数模板"></a>main函数模板</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include &lt;QApplication&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QApplication a(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> a.exec();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="方便调试时查看打印信息的方式"><a href="#方便调试时查看打印信息的方式" class="headerlink" title="方便调试时查看打印信息的方式"></a>方便调试时查看打印信息的方式</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include &lt;QDebug&gt;</span></span><br><span class="line">//方便调试时的打印输出</span><br><span class="line"><span class="comment">#define cout qDebug() &lt;&lt; &quot;[&quot; &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot;] &quot;</span></span><br><span class="line">//最终输出: 能看到文件信息, 与第几行</span><br><span class="line">//[ ..\QDataStream\mainwidget.cpp : 51 ] <span class="string">&quot;sorrowfeng彭烈枫&quot;</span> 100</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="QWidget与QMainWindow"><a href="#QWidget与QMainWindow" class="headerlink" title="QWidget与QMainWindow"></a>QWidget与QMainWindow</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QWidget不带菜单栏, 而QMainWindow有菜单栏</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="打包exe的方法"><a href="#打包exe的方法" class="headerlink" title="打包exe的方法"></a>打包exe的方法</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">先将release里的exe文件拷贝到别的地方</span><br><span class="line">在qt自带的命令行里, <span class="built_in">cd</span>到exe所在的文件夹, 输入命令</span><br><span class="line">windeployqt hello.exe</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="使exe文件有图标的方法"><a href="#使exe文件有图标的方法" class="headerlink" title="使exe文件有图标的方法"></a>使exe文件有图标的方法</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1.创建.rc文件</span><br><span class="line">新建文本文件并将后缀改为.rc，这里将其命名为app.rc</span><br><span class="line"> 2.编辑.rc文件</span><br><span class="line">此时需要一个XXX.ico图标文件，使用文本编辑器打开.rc文件并写入以下内容</span><br><span class="line">IDI_ICON1 ICON DISCARDABLE <span class="string">&quot;XXX.ico&quot;</span></span><br><span class="line"> 3.添加.rc文件</span><br><span class="line">在Qt应用工程文件中，使用RC_FILE添加.rc文件</span><br><span class="line">RC_FILE += app.rc</span><br><span class="line">然后编译生成exe文件后，可以看到exe文件已有图标</span><br><span class="line">ico与rc文件都放在与工程文件(pro文件)同目录下</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="在MainWidget以外的cpp中使用ui的方法"><a href="#在MainWidget以外的cpp中使用ui的方法" class="headerlink" title="在MainWidget以外的cpp中使用ui的方法"></a>在MainWidget以外的cpp中使用ui的方法</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">将ui指针传入</span><br><span class="line"><span class="comment">#include   &lt;ui_mainwindow.h&gt;</span></span><br><span class="line">void FileManagemnt::OpenFile(Ui::MainWindow *u)&#123;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="加载qss资源文件"><a href="#加载qss资源文件" class="headerlink" title="加载qss资源文件"></a>加载qss资源文件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QFile qssFile(<span class="string">&quot;://style/beautify.qss&quot;</span>);</span><br><span class="line">qssFile.open(QFile::ReadOnly);</span><br><span class="line">QString qss = qssFile.readAll();</span><br><span class="line">this-&gt;setStyleSheet(qss);</span><br><span class="line">qssFile.close();</span><br></pre></td></tr></table></figure>

<h1 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#include &lt;QPushButton&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">QWidget w;</span><br><span class="line">w.setWindowTitle(<span class="string">&quot;nihao&quot;</span>);//显示窗口标题</span><br><span class="line"></span><br><span class="line">QPushButton b;</span><br><span class="line">b.setText(<span class="string">&quot;hello&quot;</span>); //指定按钮内容</span><br><span class="line">b.setParent(&amp;w);    //指定按钮父类,通过setParent函数</span><br><span class="line">b.move(100,200);    //移动坐标</span><br><span class="line"></span><br><span class="line">QPushButton b1(&amp;w); //通过构造函数传参指定父对象</span><br><span class="line">b1.setText(<span class="string">&quot;nihao&quot;</span>);</span><br><span class="line">b1.move(200, 200);</span><br><span class="line"></span><br><span class="line">w.show();   //只要show父类, 指定其为父类的子类自动显示</span><br></pre></td></tr></table></figure>

<h1 id="信号与槽"><a href="#信号与槽" class="headerlink" title="信号与槽"></a>信号与槽</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">   * &amp;b1  信号发出者</span><br><span class="line">   * &amp;QPushButton::pressed    处理的信号   发送者的类名::信号名字</span><br><span class="line">   * this 信号接收者</span><br><span class="line">   * &amp;Widget::close   槽函数, 信号处理函数  接收者的类名::槽函数名字</span><br><span class="line">   */</span><br><span class="line">  connect(&amp;b1, &amp;QPushButton::pressed, this, &amp;Widget::close);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="自定义槽"><a href="#自定义槽" class="headerlink" title="自定义槽"></a>自定义槽</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">    * 自定义槽,普通函数的用法</span><br><span class="line">    * Qt5:任意的成员函数,普通全局函数,静态函数</span><br><span class="line">    * 槽函数需要和信号一致(参数,返回值)</span><br><span class="line">    * 由于信号都是没有返回值,所以,槽函数一定没有返回值</span><br><span class="line">    */</span><br><span class="line">   connect(b2, &amp;QPushButton::released, this, &amp;Widget::my_slot);</span><br><span class="line">   //这里b2不用&amp;的原因是, b2本来就是一个地址类型的</span><br><span class="line"></span><br><span class="line">   //实现按下b2, b1按钮隐藏</span><br><span class="line">   connect(b2, &amp;QPushButton::released, &amp;b1, &amp;QPushButton::hide);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   //显示子窗口</span><br><span class="line">   this-&gt;setWindowTitle(<span class="string">&quot;boss&quot;</span>);</span><br><span class="line">   b3.setParent(this);</span><br><span class="line">   b3.setText(<span class="string">&quot;convert&quot;</span>);</span><br><span class="line">   b3.move(100,100);</span><br><span class="line"></span><br><span class="line">   //处理子窗口b3按键按下事件, 使得子窗口显示, 父窗口隐藏</span><br><span class="line">  connect(&amp;b3, &amp;QPushButton::released, this, &amp;Widget::change);</span><br><span class="line"></span><br><span class="line">  //处理子窗口传来的信号, 使得子窗口隐藏, 父窗口显示</span><br><span class="line">  connect(&amp;s, &amp;SubWidget::mySignal, this, &amp;Widget::dealSubWin);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  //重设窗口大小</span><br><span class="line">  resize(200, 200);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="自定义信号"><a href="#自定义信号" class="headerlink" title="自定义信号"></a>自定义信号</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">  /*</span><br><span class="line">     * 信号必须有 signals:关键字来声明</span><br><span class="line">     * 信号没有返回值,但可以有参数</span><br><span class="line">     * 信号就是函数的声明,只需声明,无需定义</span><br><span class="line">     * 使用: emit mysigna1();</span><br><span class="line">     * 信号可以重载</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    void mySignal();</span><br><span class="line">    void mySignal(int, QString);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//发送信号</span><br><span class="line">void SubWidget::<span class="function"><span class="title">sendSlot</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    emit this-&gt;mySignal();</span><br><span class="line">    emit this-&gt;mySignal(100, <span class="string">&quot;plf&quot;</span>); //带参数的信号</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="带参数的信号"><a href="#带参数的信号" class="headerlink" title="带参数的信号"></a>带参数的信号</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">signals:</span><br><span class="line">	void mySignal(int, QString);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">emit this-&gt;mySignal(100, <span class="string">&quot;plf&quot;</span>); //带参数的信号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//接收时, 使用函数指针来指向有参和无参的信号</span><br><span class="line">//无参数信号      //函数指针, 这里的func指向无参数信号</span><br><span class="line">   void (SubWidget::*func)() = &amp;SubWidget::mySignal;</span><br><span class="line">   connect(&amp;s, func, this, &amp;Widget::dealSubWin);</span><br><span class="line"></span><br><span class="line">   //有参数信号      //函数指针, 这里的func指向有参数信号</span><br><span class="line">   void (SubWidget::*func_arg)(int, QString) = &amp;SubWidget::mySignal;</span><br><span class="line">   connect(&amp;s, func_arg, this, &amp;Widget::dealslot);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//QT4槽函数连接, 使用SIGNAL与SLOT关键字</span><br><span class="line">//容易出错:SIGNAL SLOT将函数名字-&gt;字符串不进行错误检查</span><br><span class="line">   connect(&amp;s, SIGNAL(mySignal()), this, SLOT(dealslot()));</span><br><span class="line"></span><br><span class="line">//这种方法槽函数必须有slots关键字</span><br><span class="line">public slots:</span><br><span class="line">    void dealslot();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="lambda表达式"><a href="#lambda表达式" class="headerlink" title="lambda表达式"></a>lambda表达式</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">connect(b4, &amp;QPushButton::released,</span><br><span class="line">//=:  [=] 把外部所有局部变量、类中所有成员以值传递方式, 默认是只读的</span><br><span class="line">            //要修改需要加上关键字mutable</span><br><span class="line">            //[=]() mutable</span><br><span class="line">	    //this:类中所有成员以值传递方式</span><br><span class="line">            //&amp;:把外部所有局部变量,引用符号</span><br><span class="line">	   //[]中可以传入外部变量, 来给内部使用</span><br><span class="line">            //()中可以传入信号中的参数, 这里的bool类型是clicked信号的参数</span><br><span class="line">            [b4](bool isCheck)</span><br><span class="line">            &#123;</span><br><span class="line">                b4-&gt;setText(<span class="string">&quot;lambda&quot;</span>);</span><br><span class="line">                qDebug() &lt;&lt; <span class="string">&quot;qwerty&quot;</span> &lt;&lt; <span class="string">isCheck;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">           );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//[不传入数值</span></span><br><span class="line"><span class="string">[]()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="坐标系统"><a href="#坐标系统" class="headerlink" title="坐标系统"></a>坐标系统</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">    * 对于父窗口(主窗口),坐标系统相对于屏幕</span><br><span class="line">    * 原点:相对于屏幕左上角</span><br><span class="line">    * x:往右递增</span><br><span class="line">    * y:往下递增</span><br><span class="line">    */</span><br><span class="line">   move(100,100);</span><br><span class="line"></span><br><span class="line">   QPushButton * b1 = new QPushButton(this);</span><br><span class="line">   b1-&gt;setText(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">   /*</span><br><span class="line">    * 对于子窗口,坐标系统相对于父窗口</span><br><span class="line">    * 原点:相对于父窗口空白区域左上角(不包括边框)</span><br><span class="line">    * x:往右递增</span><br><span class="line">    * y:往下递增</span><br><span class="line">    */</span><br><span class="line">   b1-&gt;move(0,0);</span><br><span class="line">   b1-&gt;resize(100, 100);</span><br><span class="line"></span><br><span class="line">   //这里是指定父对象为按钮, 坐标则是从父按钮左上角开始</span><br><span class="line">   QPushButton * b2 = new QPushButton(b1);</span><br><span class="line">   b2-&gt;setText(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">   b2-&gt;move(10, 10);</span><br><span class="line">   b2-&gt;resize(50, 20);</span><br></pre></td></tr></table></figure>

<h1 id="内存回收机制"><a href="#内存回收机制" class="headerlink" title="内存回收机制"></a>内存回收机制</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//1)指定父对象后        2)直接或间接继承于 QObject</span><br><span class="line">//子对象如果是动态分配空间的new,不需要手动释放 delete</span><br><span class="line">//系统会自动释放</span><br></pre></td></tr></table></figure>

<h1 id="窗口界面-菜单栏-状态栏-浮动窗口等的编写"><a href="#窗口界面-菜单栏-状态栏-浮动窗口等的编写" class="headerlink" title="窗口界面, 菜单栏,状态栏, 浮动窗口等的编写"></a>窗口界面, 菜单栏,状态栏, 浮动窗口等的编写</h1><h2 id="菜单栏"><a href="#菜单栏" class="headerlink" title="菜单栏"></a>菜单栏</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QMenuBar *mBar = menuBar();</span><br><span class="line">    setMenuBar(mBar); //不设置也能显示</span><br><span class="line">    //添加菜单</span><br><span class="line">    QMenu *pFile = mBar-&gt;addMenu(<span class="string">&quot;文件&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //添加菜单项, 添加动作</span><br><span class="line">    QAction *pNew = pFile-&gt;addAction(<span class="string">&quot;新建&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //添加触发事件</span><br><span class="line">    connect(pNew, &amp;QAction::triggered,</span><br><span class="line">                [=]()</span><br><span class="line">                &#123;</span><br><span class="line">                    mBar-&gt;addMenu(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    //添加分隔线</span><br><span class="line">    pFile-&gt;addSeparator();</span><br><span class="line">    //添加菜单项, 添加动作</span><br><span class="line">    QAction *pOpen = pFile-&gt;addAction(<span class="string">&quot;打开&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="工具栏-是菜单项的快捷方式"><a href="#工具栏-是菜单项的快捷方式" class="headerlink" title="工具栏, 是菜单项的快捷方式"></a>工具栏, 是菜单项的快捷方式</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QToolBar *toolBar = addToolBar(<span class="string">&quot;toolBar&quot;</span>);</span><br><span class="line"></span><br><span class="line">  //工具栏添加快捷键, 将要实现功能的指针传入就行了, 这里传入的是新建的动作</span><br><span class="line">  toolBar-&gt;addAction(pNew);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  //在工具栏添加按钮</span><br><span class="line">  QPushButton *button = new QPushButton(this);</span><br><span class="line">  button-&gt;setText(<span class="string">&quot;***&quot;</span>);</span><br><span class="line">  //添加小控件, 在toolBar上添加控件(如按钮)</span><br><span class="line">  toolBar-&gt;addWidget(button);</span><br><span class="line">  //添加动作</span><br><span class="line">  connect(button, &amp;QPushButton::pressed,</span><br><span class="line">          [=]()</span><br><span class="line">          &#123;</span><br><span class="line">              button-&gt;setText(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">              qDebug() &lt;&lt; <span class="string">&quot;new&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="状态栏"><a href="#状态栏" class="headerlink" title="状态栏"></a>状态栏</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QStatusBar *fettleBar = statusBar();</span><br><span class="line">//添加标签控件</span><br><span class="line">QLabel *label = new QLabel(this);</span><br><span class="line">label-&gt;setText(<span class="string">&quot;www.sorrowfeng.top&quot;</span>);</span><br><span class="line"></span><br><span class="line">//给状态栏来添加一个label控件来显示</span><br><span class="line">fettleBar-&gt;addWidget(label);</span><br><span class="line"></span><br><span class="line">//addWidget从左往右添加, 这里用的是QLabel构造函数直接创建</span><br><span class="line">fettleBar-&gt;addWidget(new QLabel(<span class="string">&quot;1399600304&quot;</span>, this));</span><br><span class="line">//addPermanentWidget从右往左添加</span><br><span class="line">fettleBar-&gt;addPermanentWidget(new QLabel(<span class="string">&quot;sorrowfenggg&quot;</span>, this));</span><br></pre></td></tr></table></figure>

<h2 id="核心控件-文本框"><a href="#核心控件-文本框" class="headerlink" title="核心控件,文本框"></a>核心控件,文本框</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QTextEdit *textEdit = new QTextEdit(this);</span><br><span class="line">setCentralWidget(textEdit); //添加中心文本框</span><br></pre></td></tr></table></figure>

<h2 id="浮动窗口"><a href="#浮动窗口" class="headerlink" title="浮动窗口"></a>浮动窗口</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QDockWidget *dockWidget = new QDockWidget(this);</span><br><span class="line">   addDockWidget(Qt::RightDockWidgetArea,dockWidget);  //添加浮动窗口</span><br><span class="line">   //为浮动窗口添加一个文本控件</span><br><span class="line">   QTextEdit *textEditDock = new QTextEdit(this);</span><br><span class="line">   dockWidget-&gt;setWidget(textEditDock);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="模态对话框与非模态对话框"><a href="#模态对话框与非模态对话框" class="headerlink" title="模态对话框与非模态对话框"></a>模态对话框与非模态对话框</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QMenuBar *mBar = menuBar();</span><br><span class="line">    setMenuBar(mBar); //不设置也能显示</span><br><span class="line"></span><br><span class="line">    QMenu *pNew = mBar-&gt;addMenu(<span class="string">&quot;新建&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QAction *pMotai = pNew-&gt;addAction(<span class="string">&quot;新建模态对话框&quot;</span>);</span><br><span class="line">    QAction *pUnMotai = pNew-&gt;addAction(<span class="string">&quot;新建非模态对话框&quot;</span>);</span><br><span class="line">    //显示模态对话框</span><br><span class="line">    connect(pMotai, &amp;QAction::triggered,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                QDialog dlg;</span><br><span class="line">                dlg.exec();</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line">    //显示非模态对话框</span><br><span class="line">    connect(pUnMotai, &amp;QAction::triggered,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                //方法一:将dlg作为成员变量</span><br><span class="line">                dlg.show();</span><br><span class="line"></span><br><span class="line">                //方法二:不指定父对象, 设置属性delete对象</span><br><span class="line">                //并不使用指定父对象的方法, 因为指定父对象只有在父对象被释放时才会释放, 容易占用内存过多</span><br><span class="line">                QDialog *p = new QDialog;</span><br><span class="line">                //设置属性: 在关闭时delete对象</span><br><span class="line">                p-&gt;setAttribute(Qt::WA_DeleteOnClose);</span><br><span class="line">                p-&gt;show();</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Dialog对话框"><a href="#Dialog对话框" class="headerlink" title="Dialog对话框"></a>Dialog对话框</h1><h2 id="显示关于对话框"><a href="#显示关于对话框" class="headerlink" title="显示关于对话框"></a>显示关于对话框</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">connect(pAbout, &amp;QAction::triggered,</span><br><span class="line">          [=]()</span><br><span class="line">          &#123;</span><br><span class="line">              QMessageBox::about(this, <span class="string">&quot;关于&quot;</span>, <span class="string">&quot;www.sorrowfeng.top&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line">  QAction *pQuestion = pNew-&gt;addAction(<span class="string">&quot;问题对话框&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="显示问题对话框"><a href="#显示问题对话框" class="headerlink" title="显示问题对话框"></a>显示问题对话框</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">connect(pQuestion, &amp;QAction::triggered,</span><br><span class="line">          [=]()</span><br><span class="line">          &#123;</span><br><span class="line">              int ret = QMessageBox::question(this, <span class="string">&quot;question&quot;</span>, <span class="string">&quot;确认?&quot;</span>, QMessageBox::Ok | QMessageBox::Cancel);</span><br><span class="line">              //对按下之后的返回值做处理</span><br><span class="line">              switch(ret)</span><br><span class="line">              &#123;</span><br><span class="line">              <span class="keyword">case</span> QMessageBox::Ok:</span><br><span class="line">                  qDebug() &lt;&lt; <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">                  <span class="built_in">break</span>;</span><br><span class="line">              <span class="keyword">case</span> QMessageBox::Cancel:</span><br><span class="line">                  qDebug() &lt;&lt; <span class="string">&quot;cancel&quot;</span>;</span><br><span class="line">                  <span class="built_in">break</span>;</span><br><span class="line">              default:</span><br><span class="line">                  <span class="built_in">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="显示打开文件对话框"><a href="#显示打开文件对话框" class="headerlink" title="显示打开文件对话框"></a>显示打开文件对话框</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QAction *pFileDlg = pNew-&gt;addAction(<span class="string">&quot;文件对话框&quot;</span>);</span><br><span class="line"> connect(pFileDlg, &amp;QAction::triggered,</span><br><span class="line">         [=]()</span><br><span class="line">         &#123;</span><br><span class="line">             QString path = QFileDialog::getOpenFileName(</span><br><span class="line">                         this,</span><br><span class="line">                         <span class="string">&quot;open&quot;</span>, //打开标题名</span><br><span class="line">                         <span class="string">&quot;../&quot;</span>,  //打开路径</span><br><span class="line">                         <span class="string">&quot;source(*.c *.cpp *.h);;text(*.txt *.md);;all(*.*)&quot;</span> //过滤文件格式</span><br><span class="line">                         );</span><br><span class="line">             qDebug() &lt;&lt; <span class="string">path;</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">         );</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="常用控件的使用"><a href="#常用控件的使用" class="headerlink" title="常用控件的使用"></a>常用控件的使用</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">这里的lineEdit通过ui文件设置</span><br><span class="line">//获取输入框文本</span><br><span class="line">    QString str = ui-&gt;lineEdit-&gt;text();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">str;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //修改输入框文本</span></span><br><span class="line"><span class="string">    ui-&gt;lineEdit-&gt;setText(&quot;hello&quot;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //设置内容显示间隙</span></span><br><span class="line"><span class="string">    ui-&gt;lineEdit-&gt;setTextMargins(15, 0, 0, 0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //设置内容显示方式</span></span><br><span class="line"><span class="string">    ui-&gt;lineEdit-&gt;setEchoMode(QLineEdit::PasswordEchoOnEdit);</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="自定义控件"><a href="#自定义控件" class="headerlink" title="自定义控件"></a>自定义控件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">     * 自定义控件</span><br><span class="line">     * 新建一个class, 继承于基类</span><br><span class="line">     * 继承于基类, 要提升QLabel就要继承于QLabel, 提升QWidget就继承于QWidget</span><br><span class="line">     * 在ui界面使用时, 先放一个布局, 右键, 提升为, 填写类名, 一般勾上全局包含</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    QSpinBox *spin = new QSpinBox(this);</span><br><span class="line">    QSlider *slider = new QSlider(Qt::Horizontal,this);</span><br><span class="line"></span><br><span class="line">    //把控件添加到布局中</span><br><span class="line">    QHBoxLayout *hLayout = new QHBoxLayout(this);</span><br><span class="line">    hLayout-&gt;addWidget(spin);</span><br><span class="line">    hLayout-&gt;addWidget(slider);</span><br><span class="line"></span><br><span class="line">    //setLayout(hLayout);   //没有指定父对象时需要人为添加</span><br><span class="line"></span><br><span class="line">    //另一种选择重载信号的方式</span><br><span class="line">    //通过数值改变滑块的位置</span><br><span class="line">    connect(spin, static_cast&lt;void (QSpinBox::*) (int)&gt;(&amp;QSpinBox::valueChanged),</span><br><span class="line">            slider, &amp;QSlider::setValue);</span><br><span class="line"></span><br><span class="line">    //通过滑块的位置改变数值</span><br><span class="line">    connect(slider, &amp;QSlider::valueChanged, spin, &amp;QSpinBox::setValue);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="样式修改"><a href="#样式修改" class="headerlink" title="样式修改"></a>样式修改</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//    部件的前景色用于绘制上面的文本,可以通过 color属性指定。</span><br><span class="line">    //    背景色用于绘制部件的壤充矩形,可以通过 background-color属性指定。</span><br><span class="line">    //    背景图片使用 background-image属性定义,它用于绘制由 background-origin</span><br><span class="line">    //    指定的矩形区域(空白、边框、填充或内容)。背景图片在矩形区域内的对齐和</span><br><span class="line">    //    平铺方式可以通过 background-position和 background-repeat隅性指定</span><br><span class="line">    //    如果指定的背景图片具有a1pha通道(即有半透明效果),通过 background-color</span><br><span class="line">    //    指定的颜色将会透过透明区域,这一功能可以使背景图片在多种环境下重复利用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //全局样式</span><br><span class="line">//    this-&gt;setStyleSheet(<span class="string">&quot;QLabel&#123; color:#0000ff; &quot;</span></span><br><span class="line">//                             <span class="string">&quot;background-color:#cecece;&quot;</span></span><br><span class="line">//                             <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    //设置样式, 针对某标签的样式//设置图片背景</span><br><span class="line">    ui-&gt;label-&gt;setStyleSheet(<span class="string">&quot;QLabel&#123; color:#af0fef;&quot;</span></span><br><span class="line">                             <span class="string">&quot;background-color:#bebebe;&quot;</span></span><br><span class="line">//                             <span class="string">&quot;background-image:url(://Image/image.png);&quot;</span>   //自动平铺</span><br><span class="line">                             <span class="string">&quot;border-image:url(://Image/image.png);&quot;</span>    //自适应</span><br><span class="line">                             <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //伪状态</span><br><span class="line">    ui-&gt;pushButton-&gt;setStyleSheet(<span class="string">&quot;QPushButton&#123;&quot;</span></span><br><span class="line">                                  <span class="string">&quot;border: 2px outset green;&quot;</span></span><br><span class="line">                                  <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">                                  <span class="string">&quot;QPushButton:pressed&#123;&quot;</span>    //按下后改变状态</span><br><span class="line">                                  <span class="string">&quot;border-image:url(://Image/image.png);&quot;</span></span><br><span class="line">                                  <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //下面是可用的伪状态列表:</span><br><span class="line">    //伪状态描述</span><br><span class="line">    //:checked  button部伴被选中</span><br><span class="line">    //:disabled 部件被禁用</span><br><span class="line">    //:enabled  部件被启用</span><br><span class="line">    //:focus    部件获得焦点</span><br><span class="line">    //:hover    鼠标位于部件上</span><br><span class="line">    //:indeterminate    checkbox或 radiobutton被部分选中</span><br><span class="line">    //:off      部件可以切换,且处于off状态</span><br><span class="line">    //:on       部件可以切换,且处于on状态</span><br><span class="line">    //:pressed  部件被鼠标按下</span><br><span class="line">    //:unchecked        button部件未被选中</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">Qt程序得要在main0函数创建一个QApplication</span><br><span class="line">对象,然后调用它的<span class="built_in">exec</span>()函数。这个函数就是开始Qt的事件循环。在执行</span><br><span class="line"><span class="built_in">exec</span>()函数之后,程序将进入事件循环来监听应用程序的事件。当事件发生时,</span><br><span class="line">Qt将创建一个事件对象。Qt中所有事件类都继承于 QEvent。在事件对象创建</span><br><span class="line">完毕后,Qt将这个事件对象传递给 QObject的 event()函数。 event()函数并不</span><br><span class="line">直接处理事件,而是按照事件对象的类型分派给特定的事件处理函数( event</span><br><span class="line">handler),</span><br><span class="line">在所有组件的父类 QWidget中,定义了很多事件处理的回调函数,如</span><br><span class="line">keyPressEvent()</span><br><span class="line">keyReleaseEvent()</span><br><span class="line">mouseDoubleClickEvent()</span><br><span class="line">mouseMoveEvent()</span><br><span class="line">mousePressEvent()</span><br><span class="line">mouseReleaseEvent()等*/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="自定义的label控件"><a href="#自定义的label控件" class="headerlink" title="自定义的label控件"></a>自定义的label控件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*以下为自定义的label控件, 在其中调用event事件*/</span><br><span class="line">MyLabel::MyLabel(QWidget *parent) : QLabel(parent)</span><br><span class="line">&#123;</span><br><span class="line">    //设置默认追踪鼠标, 这样这个例子里鼠标一进入就可以移动了, 不需要点一下</span><br><span class="line">    this-&gt;setMouseTracking(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void MyLabel::mousePressEvent(QMouseEvent *ev)</span><br><span class="line">&#123;</span><br><span class="line">    /*</span><br><span class="line">     * Qt中格式化为字符串的方法</span><br><span class="line">     * %1, %2 代表第一个第二个要填充的位置, 分别对应后面arg里的参数</span><br><span class="line">     * QString str = QString(<span class="string">&quot;hello %1 !! %2&quot;</span>).arg(<span class="string">&quot;sorrowfeng&quot;</span>).arg(1999)</span><br><span class="line">     */</span><br><span class="line">    int mouseX = ev-&gt;x();</span><br><span class="line">    int mouseY = ev-&gt;y();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ev-&gt;button() == Qt::LeftButton) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">&quot;左键按下&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ev-&gt;button() == Qt::RightButton) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">&quot;右键按下&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ev-&gt;button() == Qt::MidButton) &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">&quot;中键按下&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QString posXY = QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;Pressed X: %1 Y: %2&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(mouseX).arg(mouseY);</span><br><span class="line"></span><br><span class="line">    this-&gt;setText(posXY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MyLabel::mouseReleaseEvent(QMouseEvent *ev)</span><br><span class="line">&#123;</span><br><span class="line">    QString posXY = QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;Release X: %1 Y: %2&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(ev-&gt;x()).arg(ev-&gt;y());</span><br><span class="line">    this-&gt;setText(posXY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MyLabel::mouseMoveEvent(QMouseEvent *ev)</span><br><span class="line">&#123;</span><br><span class="line">    QString posXY = QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;Move X: %1 Y: %2&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(ev-&gt;x()).arg(ev-&gt;y());</span><br><span class="line">//    this-&gt;setText(posXY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MyLabel::enterEvent(QEvent *)</span><br><span class="line">&#123;</span><br><span class="line">    QString text = QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;enter&lt;/h1&gt;&lt;/center&gt;&quot;</span>);</span><br><span class="line">    this-&gt;setText(text);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MyLabel::leaveEvent(QEvent *)</span><br><span class="line">&#123;</span><br><span class="line">    QString text = QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;leave&lt;/h1&gt;&lt;/center&gt;&quot;</span>);</span><br><span class="line">    this-&gt;setText(text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="响应键盘事件与定时器事件"><a href="#响应键盘事件与定时器事件" class="headerlink" title="响应键盘事件与定时器事件"></a>响应键盘事件与定时器事件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line"></span><br><span class="line">    this-&gt;<span class="built_in">id</span> = this-&gt;startTimer(1000); //间隔1000ms进入一次定时中断函数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWidget::~<span class="function"><span class="title">MainWidget</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::keyPressEvent(QKeyEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(e-&gt;key() == Qt::Key_Escape)</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">&quot;esc被按下&quot;</span>;</span><br><span class="line">        this-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::timerEvent(QTimerEvent *)</span><br><span class="line">&#123;</span><br><span class="line">    static int sec = 0;</span><br><span class="line">    <span class="keyword">if</span>(sec == 10)</span><br><span class="line">        this-&gt;killTimer(<span class="built_in">id</span>);    //停止定时器</span><br><span class="line"></span><br><span class="line">    ui-&gt;label-&gt;setText(QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;time %1&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(sec++));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="事件的接收与忽略"><a href="#事件的接收与忽略" class="headerlink" title="事件的接收与忽略"></a>事件的接收与忽略</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//accept, ignore通常使用方法</span><br><span class="line">void MainWidget::closeEvent(QCloseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    int ret = QMessageBox::question(this, <span class="string">&quot;close&quot;</span>, <span class="string">&quot;sure close?&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ret == QMessageBox::Yes)</span><br><span class="line">    &#123;</span><br><span class="line">        //关闭窗口</span><br><span class="line">        //处理窗口关闭事件, 接收事件, 事件就不会继续往下传递</span><br><span class="line">        e-&gt;accept();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        //不关闭窗口</span><br><span class="line">        //忽略事件, 事件继续给父组件传递</span><br><span class="line">        e-&gt;ignore();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="event函数的使用"><a href="#event函数的使用" class="headerlink" title="event函数的使用"></a>event函数的使用</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//通常不修改event函数, 容易出问题</span><br><span class="line"></span><br><span class="line">bool MainWidget::event(QEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">//    事件分发</span><br><span class="line">//    switch (e-&gt;<span class="built_in">type</span>()) &#123;</span><br><span class="line">//    <span class="keyword">case</span> QEvent::Close:</span><br><span class="line">//        closeEvent(e);</span><br><span class="line">//        <span class="built_in">break</span>;</span><br><span class="line">//    <span class="keyword">case</span> QEvent::MouseMove:</span><br><span class="line">//        mouseMoveEvent(e);</span><br><span class="line">//        <span class="built_in">break</span>;</span><br><span class="line">//    default:</span><br><span class="line">//        <span class="built_in">break</span>;</span><br><span class="line">//    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(e-&gt;<span class="built_in">type</span>() == QEvent::Timer)</span><br><span class="line">    &#123;</span><br><span class="line">        //将QEvent *类型的e转换成QTimerEvent *类型</span><br><span class="line">//        QTimerEvent * ev = static_cast&lt;QTimerEvent *&gt;(e);</span><br><span class="line">//        timerEvent(ev);</span><br><span class="line">        //这里事件停止传播, 目的时直接在上层关掉定时器</span><br><span class="line">        //返回<span class="literal">true</span>事件停止传播</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(e-&gt;<span class="built_in">type</span>() == QEvent::KeyPress)</span><br><span class="line">    &#123;</span><br><span class="line">        //这里的含义是, 直接在上层处理按键J, J则原样方式传播, 其他则停止传播</span><br><span class="line">        QKeyEvent *ev = static_cast&lt;QKeyEvent *&gt;(e);</span><br><span class="line">        <span class="keyword">if</span>(ev-&gt;key() == Qt::Key_J)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">return</span> QWidget::event(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        //使其他事件按照原来方式继续传播</span><br><span class="line">        <span class="built_in">return</span> QWidget::event(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="事件过滤器"><a href="#事件过滤器" class="headerlink" title="事件过滤器"></a>事件过滤器</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bool MainWidget::eventFilter(QObject *obj, QEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(obj == ui-&gt;label_2) &#123;</span><br><span class="line">        QMouseEvent *ev = static_cast&lt;QMouseEvent *&gt;(e);</span><br><span class="line">        <span class="keyword">if</span>(e-&gt;<span class="built_in">type</span>() == QEvent::MouseMove) &#123;</span><br><span class="line">            ui-&gt;label_2-&gt;setText(QString(<span class="string">&quot;&lt;center&gt;&lt;h1&gt;%1 %2&lt;/h1&gt;&lt;/center&gt;&quot;</span>).arg(ev-&gt;x()).arg(ev-&gt;y()));</span><br><span class="line">            <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> QWidget::eventFilter(obj, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="生成随机数"><a href="#生成随机数" class="headerlink" title="生成随机数"></a>生成随机数</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int num;</span><br><span class="line">    //以从0时0分0秒到现在的秒数为种子</span><br><span class="line">    qsrand(uint(QTime(0,0,0).secsTo(QTime::currentTime()) ));</span><br><span class="line">    //调用全局的 qrand()函数生成随机数,对10000取余,保证位于10000的范围内</span><br><span class="line">    <span class="keyword">while</span>(( num = qrand()%10000)&lt;999 );</span><br></pre></td></tr></table></figure>

<h1 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//指定绘图设备</span><br><span class="line">    //方法一: 构造函数传参</span><br><span class="line">    QPainter p(this);</span><br><span class="line"></span><br><span class="line">    //方法二: 使用begin与end函数</span><br><span class="line">//    QPainter p;</span><br><span class="line">//    p.begin(this);</span><br><span class="line">//    绘图操作</span><br><span class="line">//    p.end();</span><br><span class="line"></span><br><span class="line">    //画背景图</span><br><span class="line">    //注意图片文件夹要放在工程文件夹的同一级路径, 资源文件夹才放在工程文件夹里面</span><br><span class="line">//    p.drawPixmap(0, 0, width(), height(), QPixmap(<span class="string">&quot;../image/background.png&quot;</span>));</span><br><span class="line">    p.drawPixmap(rect(), QPixmap(<span class="string">&quot;../image/background.png&quot;</span>));//使用rect()可以直接获取窗口的巨型区域</span><br><span class="line"></span><br><span class="line">    //自定义画笔</span><br><span class="line">    QPen pen;</span><br><span class="line">    pen.setWidth(8);//设定宽度</span><br><span class="line">    pen.setColor(<span class="string">&quot;#FFFFFF&quot;</span>);//设置颜色</span><br><span class="line">    pen.setStyle(Qt::DashLine);//设置风格</span><br><span class="line">    //把画笔交给画家</span><br><span class="line">    p.setPen(pen);</span><br><span class="line"></span><br><span class="line">    //创建画刷对象</span><br><span class="line">    QBrush brush;</span><br><span class="line">    brush.setColor(Qt::white);//画刷颜色</span><br><span class="line">    brush.setStyle(Qt::SolidPattern);//填充风格</span><br><span class="line">    //把画刷交给画家</span><br><span class="line">    p.setBrush(brush);</span><br><span class="line"></span><br><span class="line">    //画直线</span><br><span class="line">    p.drawLine(0, 0, 200, 200);</span><br><span class="line">    //画矩形</span><br><span class="line">    p.drawRect(10, 10, 100, 100);</span><br><span class="line">    //画圆形</span><br><span class="line">    p.drawEllipse(QPoint(200, 200), 20, 20);</span><br><span class="line">    //画图片, 宽高可以不写, 不写则是图片原始宽高</span><br><span class="line">    p.drawPixmap(x, 200, 80, 80, QPixmap(<span class="string">&quot;../image/icon.png&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="窗口重绘"><a href="#窗口重绘" class="headerlink" title="窗口重绘"></a>窗口重绘</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//如果给窗口绘图, 一定要写在paintEvent里面</span><br><span class="line">//不要写在paintEvent()里面, 会进入无限递归</span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_pushButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;x += 20;</span><br><span class="line">    <span class="keyword">if</span>(x &gt;= width()) this-&gt;x = 0;</span><br><span class="line">    //整个窗口都重绘, 传入参数可以指定重绘某个区域, </span><br><span class="line">    this-&gt;update(); //窗口重绘, 间接重绘paintEvent()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="QPixmap与QBitmap"><a href="#QPixmap与QBitmap" class="headerlink" title="QPixmap与QBitmap"></a>QPixmap与QBitmap</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//QPixmap用于画彩色图片, QBitmap用于画黑白图片</span><br><span class="line">//QPixmap背景透明</span><br><span class="line">    p.drawPixmap(200, 100, 80, 80, QPixmap(<span class="string">&quot;../image/icon.png&quot;</span>));</span><br><span class="line">    //QBitmap背景透明</span><br><span class="line">    p.drawPixmap(300, 100, 80, 80, QBitmap(<span class="string">&quot;../image/icon.png&quot;</span>));</span><br><span class="line">    //QPixmap背景白色</span><br><span class="line">    QPixmap pixmap;</span><br><span class="line">    pixmap.load(<span class="string">&quot;../image/icon.png&quot;</span>);</span><br><span class="line">    p.drawPixmap(0, 100, 80, 80, pixmap);</span><br><span class="line">    //QBitmap背景白色</span><br><span class="line">    QBitmap bitmap;</span><br><span class="line">    bitmap.load(<span class="string">&quot;../image/icon.png&quot;</span>);</span><br><span class="line">    p.drawPixmap(100, 100, 80, 80, bitmap);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="绘图设备"><a href="#绘图设备" class="headerlink" title="绘图设备"></a>绘图设备</h1><h2 id="QPixmap"><a href="#QPixmap" class="headerlink" title="QPixmap"></a>QPixmap</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> //这里不在窗口里面绘图, 可以在这里写, 要是再窗口里面绘图, 一定要在paintEvent里面写</span><br><span class="line">    //绘图设备</span><br><span class="line">    QPixmap pixmap(400, 300);</span><br><span class="line">    //指定绘图设备</span><br><span class="line">    QPainter p(&amp;pixmap);</span><br><span class="line">    //填充白色背景色</span><br><span class="line">//    p.fillRect(rect(), QBrush(Qt::white));</span><br><span class="line">    pixmap.fill(Qt::white);</span><br><span class="line">    //在绘图设备里画图片</span><br><span class="line">    p.drawPixmap(0, 0, 80, 80, QPixmap(<span class="string">&quot;../image/icon.png&quot;</span>));</span><br><span class="line">    //保存图片</span><br><span class="line">    pixmap.save(<span class="string">&quot;../pixmap_save.png&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="QImage"><a href="#QImage" class="headerlink" title="QImage"></a>QImage</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">    //创建绘图设备,QImage::Format_ARGB32背景是透明</span><br><span class="line">    QImage image(400, 300, QImage::Format_ARGB32);</span><br><span class="line">    //指定绘图设备</span><br><span class="line">    QPainter p(&amp;image);</span><br><span class="line">    //画图</span><br><span class="line">    p.drawImage(0,0,QImage(<span class="string">&quot;../image/background.png&quot;</span>));</span><br><span class="line">    //可以对图片进行操作, 这里将前50个像素点变成红色</span><br><span class="line">    <span class="keyword">for</span> (int i=0;i&lt;50;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (int j=0;j&lt;50;j++) &#123;</span><br><span class="line">            image.setPixel(QPoint(i,j), qRgb(255, 0, 0));   //设置像素点</span><br><span class="line">//            image.pixel(QPoint(i,j));//也可以获取像素点</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //保存图片</span><br><span class="line">    image.save(<span class="string">&quot;../image_save.png&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="QPicture"><a href="#QPicture" class="headerlink" title="QPicture"></a>QPicture</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//可以显示在窗口上, 保存的图片是打不开的, 因为保存的只是二进制数据 </span><br><span class="line">//二进制文件可以发给别处, 能够原样显示出来   </span><br><span class="line">    QPicture picture;</span><br><span class="line">    QPainter p(&amp;picture);</span><br><span class="line"></span><br><span class="line">    p.drawPixmap(0, 0, 100, 100, QPixmap(<span class="string">&quot;../image/background.png&quot;</span>));</span><br><span class="line">    p.drawLine(0, 0, 50, 50);</span><br><span class="line"></span><br><span class="line">    p.end();</span><br><span class="line"></span><br><span class="line">    picture.save(<span class="string">&quot;../picture_save.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">void MainWidget::paintEvent(QPaintEvent *)</span><br><span class="line">&#123;</span><br><span class="line">    QPicture pic;</span><br><span class="line">    pic.load(<span class="string">&quot;../picture_save.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QPainter p(this);</span><br><span class="line">    p.drawPicture(0, 0, pic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="QPixmap与QImage之间的相互转换"><a href="#QPixmap与QImage之间的相互转换" class="headerlink" title="QPixmap与QImage之间的相互转换"></a>QPixmap与QImage之间的相互转换</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QPainter p(this);</span><br><span class="line">QPixmap pixmap;</span><br><span class="line">pixmap.load(<span class="string">&quot;../image/background.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">//QPixmap  to  QImage</span><br><span class="line">QImage tempImage = pixmap.toImage();</span><br><span class="line">p.drawImage(0, 0, tempImage);</span><br><span class="line"></span><br><span class="line">//QImage   to  QPixmap</span><br><span class="line">QPixmap tempPixmap = QPixmap::fromImage(tempImage);</span><br><span class="line">p.drawPixmap(0, 200, tempPixmap);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="不规则窗口"><a href="#不规则窗口" class="headerlink" title="不规则窗口"></a>不规则窗口</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    //去边框</span><br><span class="line">    this-&gt;setWindowFlag(Qt::FramelessWindowHint); // | windowFlags()</span><br><span class="line"></span><br><span class="line">    //把窗口背景设置为透明</span><br><span class="line">    this-&gt;setAttribute(Qt::WA_TranslucentBackground);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::paintEvent(QPaintEvent *)</span><br><span class="line">&#123;</span><br><span class="line">    QPainter p(this);</span><br><span class="line">    p.drawPixmap(0, 0, QPixmap(<span class="string">&quot;../image/icon.png&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::mousePressEvent(QMouseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(e-&gt;button() == Qt::RightButton) &#123;</span><br><span class="line">        //右键关闭窗口</span><br><span class="line">        this-&gt;close();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e-&gt;button() == Qt::LeftButton) &#123;</span><br><span class="line">        //求坐标差值</span><br><span class="line">        //当前点击坐标 - 窗口左上角坐标</span><br><span class="line">        p = e-&gt;globalPos() - this-&gt;frameGeometry().topLeft();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::mouseMoveEvent(QMouseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    //实现鼠标左键拖动</span><br><span class="line">    <span class="keyword">if</span>(e-&gt;buttons() &amp; Qt::LeftButton) &#123;</span><br><span class="line">        this-&gt;move(e-&gt;globalPos() - p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Qstring与QByteArray和char-之间的转换"><a href="#Qstring与QByteArray和char-之间的转换" class="headerlink" title="Qstring与QByteArray和char *之间的转换"></a>Qstring与QByteArray和char *之间的转换</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//QString to QByteArray</span><br><span class="line">           QString temp = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">           QByteArray array = temp.toUtf8();//转为utf-8, 解决中文</span><br><span class="line">           array = temp.toLocal8Bit(); //转为本地编码, 本地是是什么就转什么</span><br><span class="line"></span><br><span class="line">           //QByteArray to char *</span><br><span class="line">           char *p = array.data();</span><br><span class="line"></span><br><span class="line">           //char *  和 QByteArray  to QString</span><br><span class="line">           QString s = QString(p);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="QFile文件的读取和写入"><a href="#QFile文件的读取和写入" class="headerlink" title="QFile文件的读取和写入"></a>QFile文件的读取和写入</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">void MainWidget::<span class="function"><span class="title">on_readButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //读取中文要utf-8格式的</span><br><span class="line">    QString path = QFileDialog::getOpenFileName(this, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;../&quot;</span>, <span class="string">&quot;TXT(*.txt)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //path非空</span><br><span class="line">    <span class="keyword">if</span>(!path.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        //文件对象, 以只读方式打开, 默认只识别utf-8</span><br><span class="line">        QFile file(path);</span><br><span class="line">        <span class="keyword">if</span>(file.open(QIODevice::ReadOnly))  //如果打开成功</span><br><span class="line">        &#123;</span><br><span class="line"><span class="comment">#if 0</span></span><br><span class="line">            //一起读文件, 一般不一起读</span><br><span class="line">            QByteArray arr = file.readAll();</span><br><span class="line">            //显示到编辑区</span><br><span class="line">            ui-&gt;textEdit-&gt;setText(QString(arr));</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">            //每行读文件</span><br><span class="line">            QByteArray arr;</span><br><span class="line">            <span class="keyword">while</span> (!file.atEnd()) &#123; //当还没读到最后一行</span><br><span class="line">                arr += file.readLine(); //把每一行加到arr上</span><br><span class="line">            &#125;</span><br><span class="line">            //读取完毕显示</span><br><span class="line">            ui-&gt;textEdit-&gt;setText(arr);</span><br><span class="line">         &#125;</span><br><span class="line">        //关闭文件</span><br><span class="line">        file.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_writeButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    QString path = QFileDialog::getSaveFileName(this, <span class="string">&quot;save&quot;</span>, <span class="string">&quot;../&quot;</span>, <span class="string">&quot;TXT(*.txt);;ALL(*.*)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!path.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">        QFile file;</span><br><span class="line">        //关联文件对象</span><br><span class="line">        file.setFileName(path);</span><br><span class="line">        //以只写方式打开文件</span><br><span class="line">        <span class="keyword">if</span>(file.open(QIODevice::WriteOnly))</span><br><span class="line">        &#123;</span><br><span class="line">            //获取编辑区的内容</span><br><span class="line">            QString str = ui-&gt;textEdit-&gt;toPlainText();</span><br><span class="line">            //QString to QByteArray</span><br><span class="line">            file.write(str.toUtf8());</span><br><span class="line">        &#125;</span><br><span class="line">        file.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="获取文件信息"><a href="#获取文件信息" class="headerlink" title="获取文件信息"></a>获取文件信息</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QFileInfo info(path);</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">info.fileName();    //文件名字</span></span><br><span class="line"><span class="string">        qDebug() &lt;&lt; info</span>.suffix();      //文件后缀</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">info.created().toString(&quot;yyyy-MM-dd  hh:mm:ss&quot;);  //文件创建时间, 显示年月日时分秒</span></span><br><span class="line"><span class="string">        qDebug() &lt;&lt; info</span>.size();    //文件大小</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="QDataStream数据流操作文件"><a href="#QDataStream数据流操作文件" class="headerlink" title="QDataStream数据流操作文件"></a>QDataStream数据流操作文件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">void MainWidget::<span class="function"><span class="title">writedata</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    QFile file(<span class="string">&quot;../test.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file.open(QIODevice::WriteOnly))</span><br><span class="line">    &#123;</span><br><span class="line">        //创建数据流, 关联file</span><br><span class="line">        //往数据流中输入数据, 就是像文件中写入数据</span><br><span class="line">        QDataStream stream(&amp;file);</span><br><span class="line">        //往数据流中输入数据</span><br><span class="line">        stream &lt;&lt; <span class="string">QString(&quot;sorrowfeng彭烈枫&quot;) &lt;&lt; 100;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        file.close();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">void MainWidget::readdata()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    QFile file(&quot;../test.txt&quot;);</span></span><br><span class="line"><span class="string">    //以只读方式打开文件</span></span><br><span class="line"><span class="string">    if(file.open(QIODevice::ReadOnly))</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        QDataStream stream(&amp;file);</span></span><br><span class="line"><span class="string">        //读的时候要按写入文件的顺序读, 写的时候是先string再int, 读也要先string再int</span></span><br><span class="line"><span class="string">        QString</span> str;</span><br><span class="line">        int i;</span><br><span class="line">        //从数据流读取文件</span><br><span class="line">        stream &gt;&gt; str &gt;&gt; i;</span><br><span class="line">        //打印输出</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">str &lt;&lt; i;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        file.close();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="QTextStream操作文件"><a href="#QTextStream操作文件" class="headerlink" title="QTextStream操作文件"></a>QTextStream操作文件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//好处: 读写时可以指定编码</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">writedata</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    QFile file(<span class="string">&quot;../temp.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file.open(QIODevice::WriteOnly))</span><br><span class="line">    &#123;</span><br><span class="line">        QTextStream stream(&amp;file);  //创建文本流并绑定文件</span><br><span class="line">        stream.setCodec(<span class="string">&quot;UTF-8&quot;</span>);    //指定编码写入</span><br><span class="line">        //写入数据</span><br><span class="line">        stream &lt;&lt; <span class="string">&quot;www.sorrowfeng.top&quot;</span> &lt;&lt; <span class="string">100;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        file.close();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">void MainWidget::readdata()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    QFile file(&quot;../temp.txt&quot;);</span></span><br><span class="line"><span class="string">    if(file.open(QIODevice::ReadOnly))</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">#if 0</span></span><br><span class="line"><span class="string">        //读取文件不使用这种方法, 读取到的i的值是0, 是因为会把所有内容都给str, 没有分隔,</span></span><br><span class="line"><span class="string">        QTextStream stream(&amp;file);</span></span><br><span class="line"><span class="string">        stream.setCodec(&quot;UTF-8&quot;);    //指定编码读取</span></span><br><span class="line"><span class="string">        //读取文件</span></span><br><span class="line"><span class="string">        QString str;</span></span><br><span class="line"><span class="string">        int i;</span></span><br><span class="line"><span class="string">        stream &gt;&gt; str &gt;&gt; i;</span></span><br><span class="line"><span class="string">        cout &lt;&lt; str &lt;&lt; i;</span></span><br><span class="line"><span class="string">        //关闭文件</span></span><br><span class="line"><span class="string">        file.close();</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string">        QTextStream stream(&amp;file);</span></span><br><span class="line"><span class="string">        stream.setCodec(&quot;UTF-8&quot;);    //指定编码读取</span></span><br><span class="line"><span class="string">        QByteArray arr;</span></span><br><span class="line"><span class="string">        while(!stream.atEnd())</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            arr += stream.readLine();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        cout &lt;&lt; arr;</span></span><br><span class="line"><span class="string">        file.close();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>


<h1 id="QBuffer缓冲区"><a href="#QBuffer缓冲区" class="headerlink" title="QBuffer缓冲区"></a>QBuffer缓冲区</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QByteArray arr;</span><br><span class="line">    QBuffer buf(&amp;arr);  //将缓冲区数据放入arr</span><br><span class="line">    <span class="keyword">if</span>(buf.open(QIODevice::WriteOnly))</span><br><span class="line">    &#123;</span><br><span class="line">        buf.write(<span class="string">&quot;sorrowfeng&quot;</span>);</span><br><span class="line">        buf.write(<span class="string">&quot;1399600304&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    buf.close();</span><br><span class="line">    cout &lt;&lt; <span class="string">buf.buffer();   //打印缓冲区数据</span></span><br><span class="line"><span class="string">    cout &lt;&lt; arr;            //打印QByteArray数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //与QDataStream配合使用</span></span><br><span class="line"><span class="string">    QBuffer buf_data;</span></span><br><span class="line"><span class="string">    if(buf_data.open(QIODevice::WriteOnly))</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        QDataStream stream(&amp;buf_data);</span></span><br><span class="line"><span class="string">        stream &lt;&lt; &quot;www.sorrowfeng.top&quot;; //将内容写入缓冲区</span></span><br><span class="line"><span class="string">        buf_data.close();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    cout &lt;&lt; buf_data.buffer();   //打印缓冲区数据</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">要用网络时要加上network模块</span><br><span class="line">QT       += core gui network</span><br><span class="line">//要在项目文件的地方加上一个network</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;QTcpServer&gt;   //监听套接字</span></span><br><span class="line"><span class="comment">#include &lt;QTcpSocket&gt;   //通信套接字</span></span><br><span class="line">//服务器端需要两个套接字, 而客户端只要一个通信套接字就行了</span><br></pre></td></tr></table></figure>
<h2 id="server服务器端"><a href="#server服务器端" class="headerlink" title="server服务器端"></a>server服务器端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ServerWidget::ServerWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::ServerWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line"></span><br><span class="line">    this-&gt;setWindowTitle(<span class="string">&quot;Tcp Server(port: 8888)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //先给指针个空值, 方便后面判断</span><br><span class="line">    tcpserver = nullptr;</span><br><span class="line">    tcpsocket = nullptr;</span><br><span class="line">    //监听套接字, 指定父对象让其自动回收空间</span><br><span class="line">    tcpserver = new QTcpServer(this);</span><br><span class="line"></span><br><span class="line">    //监听, 第一个参数为默认值, 表示绑定本机网卡所有地址, 第二个参数指定端口号</span><br><span class="line">    tcpserver-&gt;listen(QHostAddress::Any, 8888);</span><br><span class="line"></span><br><span class="line">    //响应newConnection, 显示连接信息</span><br><span class="line">    connect(tcpserver, &amp;QTcpServer::newConnection,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                //下面获取出客户端传来的信息</span><br><span class="line">                //取出连接好的套接字</span><br><span class="line">                tcpsocket =  tcpserver-&gt;nextPendingConnection();</span><br><span class="line">                //取出ip地址和端口号</span><br><span class="line">                QString ip = tcpsocket-&gt;peerAddress().toString();</span><br><span class="line">                quint16 port = tcpsocket-&gt;peerPort();</span><br><span class="line">                //显示出来, 使用append追加, 用setText会覆盖</span><br><span class="line">                ui-&gt;receiveText-&gt;setText(QString(<span class="string">&quot;[%1 : %2], connected success!&quot;</span>).arg(ip).arg(port));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                //显示客户端发来的消息</span><br><span class="line">                connect(tcpsocket, &amp;QTcpSocket::readyRead,</span><br><span class="line">                        [=]()</span><br><span class="line">                        &#123;</span><br><span class="line">                            //接收从tcpsocket传来的所有内容, 并追加显示</span><br><span class="line">                            QByteArray arr = tcpsocket-&gt;readAll();</span><br><span class="line">                            ui-&gt;receiveText-&gt;append(QString(arr));</span><br><span class="line">                        &#125;</span><br><span class="line">                        );</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServerWidget::~<span class="function"><span class="title">ServerWidget</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//发送信息到客户端</span><br><span class="line">void ServerWidget::<span class="function"><span class="title">on_sendButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == tcpsocket) <span class="built_in">return</span>;</span><br><span class="line">    //发送信息到tcpsocket, 因为上面已经建立好连接了</span><br><span class="line">    //获取编辑区内容</span><br><span class="line">    QString sendstr = ui-&gt;sendText-&gt;toPlainText();</span><br><span class="line"></span><br><span class="line">    //QString 转为 QByteArray 并发送</span><br><span class="line">    tcpsocket-&gt;write(sendstr.toUtf8());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void ServerWidget::<span class="function"><span class="title">on_closeButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == tcpsocket) <span class="built_in">return</span>;</span><br><span class="line">    //主动与客户端断开连接</span><br><span class="line">    tcpsocket-&gt;disconnectFromHost();</span><br><span class="line">    tcpsocket-&gt;close();</span><br><span class="line">    tcpsocket = nullptr;   //断开之后重新赋值为空</span><br><span class="line"></span><br><span class="line">    this-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="client客户端"><a href="#client客户端" class="headerlink" title="client客户端"></a>client客户端</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clientwidget::clientwidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::clientwidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line"></span><br><span class="line">    this-&gt;setWindowTitle(<span class="string">&quot;client&quot;</span>);</span><br><span class="line">    tcpsocket = nullptr;</span><br><span class="line">    //分配内存, 并指定父对象</span><br><span class="line">    tcpsocket = new QTcpSocket(this);</span><br><span class="line">    //成功与服务器连接, 响应对面发来的connected信号</span><br><span class="line">    connect(tcpsocket, &amp;QTcpSocket::connected,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                ui-&gt;receiveText-&gt;setText(QString(<span class="string">&quot;connect success!&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    //读取客户端发来的所有内容</span><br><span class="line">    connect(tcpsocket, &amp;QTcpSocket::readyRead,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                QByteArray arr = tcpsocket-&gt;readAll();</span><br><span class="line">                ui-&gt;receiveText-&gt;append(QString(arr));</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    //对面server主动断开连接</span><br><span class="line">    connect(tcpsocket, &amp;QTcpSocket::disconnected,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                ui-&gt;receiveText-&gt;append(QString(<span class="string">&quot;server disconnect!&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clientwidget::~<span class="function"><span class="title">clientwidget</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void clientwidget::<span class="function"><span class="title">on_sendButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == tcpsocket) <span class="built_in">return</span>;</span><br><span class="line">    //获取编辑区内容</span><br><span class="line">    QString sendstr = ui-&gt;sendText-&gt;toPlainText();</span><br><span class="line">    //QString 转为 QByteArray 并发送</span><br><span class="line">    tcpsocket-&gt;write(sendstr.toUtf8());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void clientwidget::<span class="function"><span class="title">on_closeButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == tcpsocket) <span class="built_in">return</span>;</span><br><span class="line">    //主动与服务器断开连接</span><br><span class="line">    tcpsocket-&gt;disconnectFromHost();</span><br><span class="line">    tcpsocket-&gt;close();</span><br><span class="line">    tcpsocket = nullptr;</span><br><span class="line"></span><br><span class="line">    this-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void clientwidget::<span class="function"><span class="title">on_connectButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == tcpsocket) <span class="built_in">return</span>;</span><br><span class="line">    //获取输入的ip与端口号</span><br><span class="line">    QString ip = ui-&gt;ipLineEdit-&gt;text();</span><br><span class="line">    quint16 port = quint16(ui-&gt;portLineEdit-&gt;text().toInt());</span><br><span class="line"></span><br><span class="line">    //主动与服务器建立连接</span><br><span class="line">    tcpsocket-&gt;connectToHost(QHostAddress(ip), port);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    udpsocket = nullptr;</span><br><span class="line">    //分配内存</span><br><span class="line">    udpsocket = new QUdpSocket(this);</span><br><span class="line">    //绑定端口号</span><br><span class="line">    udpsocket-&gt;<span class="built_in">bind</span>(9000);</span><br><span class="line"><span class="comment">#if 0</span></span><br><span class="line">//    udpsocket-&gt;<span class="built_in">bind</span>(QHostAddress::AnyIPv4, 9000); //使用组播地址的时候要这样绑定端口号</span><br><span class="line"></span><br><span class="line">    //加入某个组播, (群聊), 组播地址必须是第一类地址</span><br><span class="line">    udpsocket-&gt;joinMulticastGroup(QHostAddress(<span class="string">&quot;224.0.0.2&quot;</span>));</span><br><span class="line">    //退出某个组播</span><br><span class="line">    udpsocket-&gt;leaveMulticastGroup(QHostAddress(<span class="string">&quot;224.0.0.2&quot;</span>));</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">    this-&gt;setWindowTitle(<span class="string">&quot;port: 9000&quot;</span>);</span><br><span class="line">    //处理接收信息, 接收数据</span><br><span class="line">    connect(udpsocket, &amp;QUdpSocket::readyRead,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                char buf[1024] = &#123;0&#125;;</span><br><span class="line">                QHostAddress clientAddr;</span><br><span class="line">                quint16 port;</span><br><span class="line">                qint64 len = udpsocket-&gt;readDatagram(buf, sizeof(buf), &amp;clientAddr, &amp;port);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(len &gt; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    QString str = QString(<span class="string">&quot;[%1 : %2] %3&quot;</span>).arg(clientAddr.toString()).arg(port).arg(buf);</span><br><span class="line"></span><br><span class="line">                    ui-&gt;textEdit-&gt;setText(str);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWidget::~<span class="function"><span class="title">MainWidget</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//发送数据</span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_sendButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == udpsocket) <span class="built_in">return</span>;</span><br><span class="line">    //获取对方的ip和端口号</span><br><span class="line">    QString ip = ui-&gt;ipLineEdit-&gt;text();</span><br><span class="line">    quint16 port = quint16(ui-&gt;portLineEdit-&gt;text().toInt());</span><br><span class="line">    //获取编辑区内容</span><br><span class="line">    char *buf = ui-&gt;textEdit-&gt;toPlainText().toUtf8().data();</span><br><span class="line">    //给指定的ip发送数据</span><br><span class="line">    udpsocket-&gt;writeDatagram(buf, sizeof(buf), QHostAddress(ip), port);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_closeButton_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nullptr == udpsocket) <span class="built_in">return</span>;</span><br><span class="line">    udpsocket-&gt;disconnectFromHost();</span><br><span class="line">    udpsocket-&gt;close();</span><br><span class="line"></span><br><span class="line">    this-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="QTImer定时器"><a href="#QTImer定时器" class="headerlink" title="QTImer定时器"></a>QTImer定时器</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line"></span><br><span class="line">    myTimer = new QTimer(this);</span><br><span class="line"></span><br><span class="line">    //响应<span class="built_in">timeout</span>信号</span><br><span class="line">    connect(myTimer, &amp;QTimer::<span class="built_in">timeout</span>,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                static int i = 0;</span><br><span class="line">                i++;</span><br><span class="line">                ui-&gt;lcdNumber-&gt;display(i);</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_buttonStart_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //启动定时器, 时间间隔为1000ms, 每隔1000ms会发出一个<span class="built_in">timeout</span>信号</span><br><span class="line">    <span class="keyword">if</span>(!myTimer-&gt;isActive())    //当定时器未激活时才启动</span><br><span class="line">        myTimer-&gt;start(1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_buttonStop_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //当定时器时启动的时候, 停止定时器</span><br><span class="line">    <span class="keyword">if</span>(myTimer-&gt;isActive())</span><br><span class="line">        myTimer-&gt;stop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">新建线程类时, 不要选QWidget, 因为它不是控件, 选Qobject</span><br></pre></td></tr></table></figure>
<h2 id="老方法"><a href="#老方法" class="headerlink" title="老方法"></a>老方法</h2><p><img src="https://s1.ax1x.com/2020/07/19/UW3xfS.png" alt="UW3xfS.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">class MyThread : public Qthread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">public:</span><br><span class="line">    explicit MyThread(QObject *parent = nullptr);</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">    //线程处理函数, 不能直接调用, 要通过start函数来间接调用</span><br><span class="line">    void run();</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    void isDone();</span><br><span class="line"></span><br><span class="line">public slots:</span><br><span class="line">&#125;;</span><br><span class="line">void MyThread::<span class="function"><span class="title">run</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //因为继承于QThread</span><br><span class="line">    this-&gt;<span class="built_in">sleep</span>(5);</span><br><span class="line"></span><br><span class="line">    emit isDone();</span><br><span class="line">&#125;</span><br><span class="line">调用</span><br><span class="line">MyThread *myThread;</span><br><span class="line">myThread = new MyThread(this);</span><br><span class="line">//不能直接调用run, 要通过start函数来间接调用</span><br><span class="line">myThread-&gt;start();</span><br><span class="line">    //点击右上角的×时, 关闭线程</span><br><span class="line">    connect(this, &amp;MainWidget::destroyed,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                //关闭线程</span><br><span class="line">                myThread-&gt;quit();</span><br><span class="line">                //等待线程处理完</span><br><span class="line">                myThread-&gt;<span class="built_in">wait</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="新方法"><a href="#新方法" class="headerlink" title="新方法"></a>新方法</h2><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/UW89yj"><img src="https://s1.ax1x.com/2020/07/19/UW89yj.png" alt="UW89yj.png"></a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">主线程</span><br><span class="line">signals:</span><br><span class="line">    void startThread(); //启动子线程的信号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line"></span><br><span class="line">    //分配内存, 注意不能指定父对象, 指定了就不能将对象移入myThread中了</span><br><span class="line">    myThread = new MyThread;</span><br><span class="line"></span><br><span class="line">    //创建子线程</span><br><span class="line">    thread = new QThread(this);</span><br><span class="line"></span><br><span class="line">    //把自定义的线程加入到子线程中</span><br><span class="line">    myThread-&gt;moveToThread(thread);</span><br><span class="line"></span><br><span class="line">    connect(myThread, &amp;MyThread::mySignal,</span><br><span class="line">            [=]()</span><br><span class="line">            &#123;</span><br><span class="line">                static int i = 0;</span><br><span class="line">                i++;</span><br><span class="line">                ui-&gt;lcdNumber-&gt;display(i);</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    connect(this, &amp;MainWidget::startThread, myThread, &amp;MyThread::myTimeOut);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWidget::~<span class="function"><span class="title">MainWidget</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_buttonStart_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //启动线程, 但没有启动线程函数</span><br><span class="line">    thread-&gt;start();</span><br><span class="line">    myThread-&gt;setFlag(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    //不能直接调用线程处理函数, 会导致线程处理函数与主线程在同一个线程</span><br><span class="line">    //只能通过signal-slot的方法来调用</span><br><span class="line">    emit startThread();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_buttonStop_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    myThread-&gt;setFlag(<span class="literal">true</span>);</span><br><span class="line">    //退出线程</span><br><span class="line">    thread-&gt;quit();</span><br><span class="line">    thread-&gt;<span class="built_in">wait</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">子线程</span><br><span class="line">    //线程处理函数</span><br><span class="line">    void myTimeOut();</span><br><span class="line">    void setFlag(bool flag = <span class="literal">true</span>); //设置标志位</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    void mySignal();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//线程处理函数, 槽函数, 等带主线程发送信号过来触发</span><br><span class="line">void MyThread::<span class="function"><span class="title">myTimeOut</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">false</span> == isStop)</span><br><span class="line">    &#123;</span><br><span class="line">        //每隔100ms发送一次信号</span><br><span class="line">        QThread::msleep(100);</span><br><span class="line">        emit mySignal();</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">true</span> == isStop)  <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MyThread::setFlag(bool flag)</span><br><span class="line">&#123;</span><br><span class="line">    isStop = flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="线程函数内部-不允许处理图形界面操作"><a href="#线程函数内部-不允许处理图形界面操作" class="headerlink" title="线程函数内部, 不允许处理图形界面操作"></a>线程函数内部, 不允许处理图形界面操作</h1><h1 id="conne第五个参数的作用"><a href="#conne第五个参数的作用" class="headerlink" title="conne第五个参数的作用"></a>conne第五个参数的作用</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//connect()函数第五个参数的作用, 指定连接方式, 默认 直接 队列</span><br><span class="line">  //只有在多线程的时候才有意义</span><br><span class="line">  //默认的时候, 如果是单线程, 用直接; 如果是多线程, 用队列</span><br><span class="line">  //队列: 槽函数所在线程与接收者一样</span><br><span class="line">  //直接: 槽函数所在线程与发送者一样</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数据库操作-QMYSQL"><a href="#数据库操作-QMYSQL" class="headerlink" title="数据库操作: QMYSQL"></a>数据库操作: QMYSQL</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">要加上模块 sql</span><br><span class="line">要将libmysql.dll的dll文件加入到qt的安装路径中Qt\Qt5.12.2\5.12.2\mingw73_32\bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &quot;mainwidget.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;ui_mainwidget.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlDatabase&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QMessageBox&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlError&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlQuery&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QVariantList&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QDebug&gt;</span></span><br><span class="line"><span class="comment">#define cout qDebug() &lt;&lt; &quot;[&quot; &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot;]&quot;</span></span><br><span class="line"></span><br><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    //打印Qt支持的数据库驱动, 模块加上sql</span><br><span class="line">    cout &lt;&lt; <span class="string">QSqlDatabase::drivers();</span></span><br><span class="line"><span class="string">    //添加MYSQL数据库</span></span><br><span class="line"><span class="string">    QSqlDatabase</span> db = QSqlDatabase::addDatabase(<span class="string">&quot;QMYSQL&quot;</span>);</span><br><span class="line">    //连接数据库</span><br><span class="line">    db.setHostName(<span class="string">&quot;127.0.0.1&quot;</span>);    //设置数据库ip</span><br><span class="line">    db.setUserName(<span class="string">&quot;root&quot;</span>);         //设置数据库用户名</span><br><span class="line">    db.setPassword(<span class="string">&quot;111111&quot;</span>);       //设置密码</span><br><span class="line">    db.setDatabaseName(<span class="string">&quot;info&quot;</span>);     //设置要使用的数据库</span><br><span class="line">    //打开数据库</span><br><span class="line">    <span class="keyword">if</span>(!db.open())</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::warning(this, <span class="string">&quot;warning&quot;</span>, db.lastError().text());</span><br><span class="line">        <span class="built_in">return</span>;  //如果打开失败</span><br><span class="line">    &#125;</span><br><span class="line">    QSqlQuery query;</span><br><span class="line"></span><br><span class="line">//    有多个数据库时, 要指定数据库,</span><br><span class="line">//    如果定义了连接名<span class="string">&quot;a&quot;</span>, 一定要在query后面指定数据库</span><br><span class="line">//    QSqlDatabase db = QSqlDatabase::addDatabase(<span class="string">&quot;QMYSQL&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">//    QSqlQuery query(db);</span><br><span class="line"></span><br><span class="line">    //执行sql语句</span><br><span class="line">    //插入数据</span><br><span class="line">    query.exec(<span class="string">&quot;insert into student values (1,&#x27;张三&#x27;,18,&#x27;一班&#x27;);&quot;</span>);</span><br><span class="line"></span><br><span class="line">    //批量插入</span><br><span class="line"><span class="comment">#if 0</span></span><br><span class="line">    //odbc风格</span><br><span class="line">    //预处理语句</span><br><span class="line">    //? 相当于占位符</span><br><span class="line">    query.prepare(<span class="string">&quot;insert into teacher(teacher_name,teacher_sex) values (?, ?);&quot;</span>);</span><br><span class="line">    //给字段设置内容 list</span><br><span class="line">    QVariantList namelist;</span><br><span class="line">    namelist &lt;&lt; <span class="string">&quot;张三&quot;</span> &lt;&lt; <span class="string">&quot;李四&quot;</span>;</span><br><span class="line">    QVariantList sexlist;</span><br><span class="line">    sexlist &lt;&lt; <span class="string">&quot;男&quot;</span> &lt;&lt; <span class="string">&quot;女&quot;</span>;</span><br><span class="line">    //给字段绑定相应的值, 一定要按顺序绑定</span><br><span class="line">    query.addBindValue(namelist);</span><br><span class="line">    query.addBindValue(sexlist);</span><br><span class="line">    //执行预处理命令</span><br><span class="line">    query.execBatch();</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">    //oracle风格</span><br><span class="line">    //占位符   : + 自定义名字</span><br><span class="line">    query.prepare(<span class="string">&quot;insert into teacher(teacher_name,teacher_sex) values (:teacher_name, :teacher_sex);&quot;</span>);</span><br><span class="line">    //给字段设置内容 list</span><br><span class="line">    QVariantList namelist;</span><br><span class="line">    namelist &lt;&lt; <span class="string">&quot;张三&quot;</span> &lt;&lt; <span class="string">&quot;李四&quot;</span>;</span><br><span class="line">    QVariantList sexlist;</span><br><span class="line">    sexlist &lt;&lt; <span class="string">&quot;男&quot;</span> &lt;&lt; <span class="string">&quot;女&quot;</span>;</span><br><span class="line">    //给字段绑定相应的值</span><br><span class="line">    query.bindValue(<span class="string">&quot;:teacher_name&quot;</span>, namelist);</span><br><span class="line">    query.bindValue(<span class="string">&quot;teacher_sex&quot;</span>, sexlist);</span><br><span class="line">    //执行预处理命令</span><br><span class="line">    query.execBatch();</span><br><span class="line"></span><br><span class="line">    //查找数据</span><br><span class="line">    query.exec(<span class="string">&quot;select * from student;&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>(query.next()) //遍历每一行</span><br><span class="line">    &#123;</span><br><span class="line">        //取出当前行的内容</span><br><span class="line">        cout &lt;&lt; <span class="string">query.value(0).toInt()  //打印当前行第0列的内容</span></span><br><span class="line"><span class="string">             &lt;&lt; query</span>.value(1).toString()</span><br><span class="line">             &lt;&lt; <span class="string">query.value(&quot;teacher_sex&quot;).toString();  //打印teacher_sex这个字段的内容</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MainWidget::~MainWidget()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    delete ui;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">void MainWidget::on_buttonDel_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    //获取编辑行内容</span></span><br><span class="line"><span class="string">    QString name = ui-&gt;lineEdit-&gt;text();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    QString sql = QString(&quot;delete from student where student_name=%1;&quot;).arg(name);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //开启一个事务</span></span><br><span class="line"><span class="string">    QSqlDatabase::database().transaction();</span></span><br><span class="line"><span class="string">    //执行sql语句</span></span><br><span class="line"><span class="string">    QSqlQuery query</span>;</span><br><span class="line">    query.exec(sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_buttonSure_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //确认删除</span><br><span class="line">    QSqlDatabase::database().commit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_buttonCancel_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //回滚, 撤销</span><br><span class="line">    QSqlDatabase::database().rollback();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数据库操作-SQLITE"><a href="#数据库操作-SQLITE" class="headerlink" title="数据库操作: SQLITE"></a>数据库操作: SQLITE</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    //打印Qt支持的数据库驱动, 模块加上sql</span><br><span class="line">    cout &lt;&lt; <span class="string">QSqlDatabase::drivers();</span></span><br><span class="line"><span class="string">    //添加MYSQL数据库</span></span><br><span class="line"><span class="string">    QSqlDatabase</span> db = QSqlDatabase::addDatabase(<span class="string">&quot;QSQLITE&quot;</span>);</span><br><span class="line">    //设置数据库</span><br><span class="line">    db.setDatabaseName(<span class="string">&quot;../info.db&quot;</span>);</span><br><span class="line">    //打开数据库</span><br><span class="line">    <span class="keyword">if</span>(!db.open())</span><br><span class="line">    &#123;</span><br><span class="line">       QMessageBox::warning(this, <span class="string">&quot;warning&quot;</span>, db.lastError().text());</span><br><span class="line">       <span class="built_in">return</span>;  //如果打开失败</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QSqlQuery query;</span><br><span class="line">    query.exec(<span class="string">&quot;create table teacher(teacher_id int primary key,teacher_name varchar(50),teacher_sex varchar(20));&quot;</span>);</span><br><span class="line">    //odbc风格</span><br><span class="line">    //预处理语句</span><br><span class="line">    //? 相当于占位符</span><br><span class="line">    query.prepare(<span class="string">&quot;insert into teacher(teacher_id, teacher_name,teacher_sex) values (?, ?, ?);&quot;</span>);</span><br><span class="line">    //给字段设置内容 list</span><br><span class="line">    QVariantList idlist;</span><br><span class="line">    idlist &lt;&lt; <span class="string">1 &lt;&lt; 2;</span></span><br><span class="line"><span class="string">    QVariantList namelist;</span></span><br><span class="line"><span class="string">    namelist &lt;&lt; &quot;张三&quot; &lt;&lt; &quot;李四&quot;;</span></span><br><span class="line"><span class="string">    QVariantList sexlist;</span></span><br><span class="line"><span class="string">    sexlist &lt;&lt; &quot;男&quot; &lt;&lt; &quot;女&quot;;</span></span><br><span class="line"><span class="string">    //给字段绑定相应的值, 一定要按顺序绑定</span></span><br><span class="line"><span class="string">    query.addBindValue(idlist);</span></span><br><span class="line"><span class="string">    query.addBindValue(namelist);</span></span><br><span class="line"><span class="string">    query.addBindValue(sexlist);</span></span><br><span class="line"><span class="string">    //执行预处理命令</span></span><br><span class="line"><span class="string">    query.execBatch();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //查找数据</span></span><br><span class="line"><span class="string">    query.exec(&quot;select * from teacher;&quot;);</span></span><br><span class="line"><span class="string">    while(query.next()) //遍历每一行</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      //取出当前行的内容</span></span><br><span class="line"><span class="string">      cout &lt;&lt; query.value(0).toInt()  //打印当前行第0列的内容</span></span><br><span class="line"><span class="string">           &lt;&lt; query.value(1</span>).toString()</span><br><span class="line">           &lt;&lt; <span class="string">query.value(&quot;teacher_sex&quot;).toString();  //打印teacher_sex这个字段的内容</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="数据库可视化操作-QSqlTableModel"><a href="#数据库可视化操作-QSqlTableModel" class="headerlink" title="数据库可视化操作:QSqlTableModel"></a>数据库可视化操作:QSqlTableModel</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include &quot;mainwidget.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;ui_mainwidget.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlTableModel&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlDatabase&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QMessageBox&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlError&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlQuery&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QVariantList&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSqlRecord&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QDebug&gt;</span></span><br><span class="line"><span class="comment">#define cout qDebug() &lt;&lt; &quot;[&quot; &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot;]&quot;</span></span><br><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    this-&gt;setWindowTitle(<span class="string">&quot;数据库可视化操作&quot;</span>);</span><br><span class="line">    //打印Qt支持的数据库驱动, 模块加上sql</span><br><span class="line">    cout &lt;&lt; <span class="string">QSqlDatabase::drivers();</span></span><br><span class="line"><span class="string">    //添加MYSQL数据库</span></span><br><span class="line"><span class="string">    QSqlDatabase</span> db = QSqlDatabase::addDatabase(<span class="string">&quot;QSQLITE&quot;</span>);</span><br><span class="line">    //设置数据库</span><br><span class="line">    db.setDatabaseName(<span class="string">&quot;../info.db&quot;</span>);</span><br><span class="line">    //打开数据库</span><br><span class="line">    <span class="keyword">if</span>(!db.open())</span><br><span class="line">    &#123;</span><br><span class="line">       QMessageBox::warning(this, <span class="string">&quot;warning&quot;</span>, db.lastError().text());</span><br><span class="line">       <span class="built_in">return</span>;  //如果打开失败</span><br><span class="line">    &#125;</span><br><span class="line">    QSqlQuery query;</span><br><span class="line">    query.exec(<span class="string">&quot;create table teacher(teacher_id int primary key,teacher_name varchar(50),teacher_sex varchar(20));&quot;</span>);</span><br><span class="line">    //odbc风格</span><br><span class="line">    //预处理语句</span><br><span class="line">    //? 相当于占位符</span><br><span class="line">    query.prepare(<span class="string">&quot;insert into teacher(teacher_id, teacher_name,teacher_sex) values (?, ?, ?);&quot;</span>);</span><br><span class="line">    //给字段设置内容 list</span><br><span class="line">    QVariantList idlist;</span><br><span class="line">    idlist &lt;&lt; <span class="string">1 &lt;&lt; 2;</span></span><br><span class="line"><span class="string">    QVariantList namelist;</span></span><br><span class="line"><span class="string">    namelist &lt;&lt; &quot;张三&quot; &lt;&lt; &quot;李四&quot;;</span></span><br><span class="line"><span class="string">    QVariantList sexlist;</span></span><br><span class="line"><span class="string">    sexlist &lt;&lt; &quot;男&quot; &lt;&lt; &quot;女&quot;;</span></span><br><span class="line"><span class="string">    //给字段绑定相应的值, 一定要按顺序绑定</span></span><br><span class="line"><span class="string">    query.addBindValue(idlist);</span></span><br><span class="line"><span class="string">    query.addBindValue(namelist);</span></span><br><span class="line"><span class="string">    query.addBindValue(sexlist);</span></span><br><span class="line"><span class="string">    //执行预处理命令</span></span><br><span class="line"><span class="string">    query.execBatch();</span></span><br><span class="line"><span class="string">    //查找数据</span></span><br><span class="line"><span class="string">    query.exec(&quot;select * from teacher;&quot;);</span></span><br><span class="line"><span class="string">    while(query.next()) //遍历每一行</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      //取出当前行的内容</span></span><br><span class="line"><span class="string">      cout &lt;&lt; query.value(0).toInt()  //打印当前行第0列的内容</span></span><br><span class="line"><span class="string">           &lt;&lt; query.value(1</span>).toString()</span><br><span class="line">           &lt;&lt; <span class="string">query.value(&quot;teacher_sex&quot;).toString();  //打印teacher_sex这个字段的内容</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //设置模型</span></span><br><span class="line"><span class="string">    model = new QSqlTableModel(this);</span></span><br><span class="line"><span class="string">    model-&gt;setTable(&quot;teacher&quot;); //使用哪个表</span></span><br><span class="line"><span class="string">    //把model放在view里面</span></span><br><span class="line"><span class="string">    ui-&gt;tableView-&gt;setModel(model);</span></span><br><span class="line"><span class="string">    //显示model里的数据</span></span><br><span class="line"><span class="string">    model-&gt;select();</span></span><br><span class="line"><span class="string">    //修改显示的列名</span></span><br><span class="line"><span class="string">    model-&gt;setHeaderData(0,Qt::Horizontal, &quot;教师编号&quot;);</span></span><br><span class="line"><span class="string">    model-&gt;setHeaderData(1,Qt::Horizontal, &quot;教师姓名&quot;);</span></span><br><span class="line"><span class="string">    model-&gt;setHeaderData(2,Qt::Horizontal, &quot;教师性别&quot;);</span></span><br><span class="line"><span class="string">    //修改编辑策略,为手动提交</span></span><br><span class="line"><span class="string">    model-&gt;setEditStrategy(QSqlTableModel::OnManualSubmit);</span></span><br><span class="line"><span class="string">    //设置view中的数据库不允许修改</span></span><br><span class="line"><span class="string">//    ui-&gt;tableView-&gt;setEditTriggers(QAbstractItemView::NoEditTriggers);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">MainWidget::~MainWidget()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    delete ui;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">void MainWidget::on_buttonAdd_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    //添加空记录</span></span><br><span class="line"><span class="string">    QSqlRecord record = model-&gt;record();    //获取空记录</span></span><br><span class="line"><span class="string">    //获取行号</span></span><br><span class="line"><span class="string">    int row = model-&gt;rowCount();</span></span><br><span class="line"><span class="string">    model-&gt;insertRecord(row, record);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">void MainWidget::on_buttonSure_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    //提交所有动作</span></span><br><span class="line"><span class="string">    model-&gt;submitAll();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">void MainWidget::on_buttonCancel_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    //取消所有动作</span></span><br><span class="line"><span class="string">    model-&gt;revertAll();</span></span><br><span class="line"><span class="string">    model-&gt;submitAll(); //提交</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">void MainWidget::on_buttonDel_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    //获取选中的模型</span></span><br><span class="line"><span class="string">    QItemSelectionModel *sModel = ui-&gt;tableView-&gt;selectionModel();</span></span><br><span class="line"><span class="string">    //取出模型中的索引</span></span><br><span class="line"><span class="string">    QModelIndexList list = sModel-&gt;selectedRows();</span></span><br><span class="line"><span class="string">    //删除所有行</span></span><br><span class="line"><span class="string">    for(int i = 0; i &lt; list.size(); i++)</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        model-&gt;removeRow(list.at(i).row());</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">void MainWidget::on_buttonFind_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    QString name = ui-&gt;lineEdit-&gt;text();</span></span><br><span class="line"><span class="string">    QString str = QString(&quot;name = &#x27;%1&#x27;&quot;).arg(name);</span></span><br><span class="line"><span class="string">    model-&gt;setFilter(str);</span></span><br><span class="line"><span class="string">    model-&gt;select();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>


<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">要在项目配置中加上xml模块</span><br><span class="line">新建c++类, 不继承任何东西</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;QString&gt;</span></span><br><span class="line">class MyXML</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    MyXML();</span><br><span class="line">    static void createXML(QString filepath);    //创建XML空文件</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &quot;myxml.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;QFile&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QTextStream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QDomDocument&gt; //文件</span></span><br><span class="line"><span class="comment">#include &lt;QDomProcessingInstruction&gt;    //格式头部</span></span><br><span class="line"><span class="comment">#include &lt;QDomElement&gt;  //元素</span></span><br><span class="line"><span class="comment">#include &lt;QDebug&gt;</span></span><br><span class="line"><span class="comment">#define cout qDebug() &lt;&lt; &quot;[&quot; &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; &quot;]&quot;</span></span><br><span class="line">MyXML::<span class="function"><span class="title">MyXML</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//创建xml空文件</span><br><span class="line">void MyXML::createXML(QString filepath)</span><br><span class="line">&#123;</span><br><span class="line">    QFile file(filepath);   //关联文件名字</span><br><span class="line">    //存在就不创建</span><br><span class="line">    <span class="keyword">if</span>(file.exists())</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;文件已经存在&quot;</span>;</span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    //不存在才创建</span><br><span class="line">    //只写方式打开文件</span><br><span class="line">    <span class="keyword">if</span>(!file.open(QIODevice::WriteOnly))</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;WriteOnly打开文件失败&quot;</span>;</span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    //创建xml文档对象</span><br><span class="line">    QDomDocument doc;</span><br><span class="line">    //创建xml头部格式</span><br><span class="line">    QDomProcessingInstruction ins;</span><br><span class="line">    //添加头部, 注意内部的引号要用\反斜杠</span><br><span class="line">    ins = doc.createProcessingInstruction(<span class="string">&quot;xml&quot;</span>,<span class="string">&quot;version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;&quot;</span>);</span><br><span class="line">    //追加元素</span><br><span class="line">    doc.appendChild(ins);</span><br><span class="line">    //根节点元素</span><br><span class="line">    QDomElement root = doc.createElement(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    doc.appendChild(root);</span><br><span class="line">    //根节点里面的元素, 在根节点上追加</span><br><span class="line">    QDomElement data = doc.createElement(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">    root.appendChild(data);</span><br><span class="line">    //保存</span><br><span class="line">    QTextStream stream(&amp;file);  //文本流关联文件</span><br><span class="line">    doc.save(stream, 4);    //doc文件关联文本流, 4代表4个缩进字符</span><br><span class="line">    //关闭文件</span><br><span class="line">    file.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">     * xml文档顺序, 所有标签节点都是元素element, 节点要转换成元素才能获取值</span><br><span class="line">     * 根节点  (documentElement)获取根节点, 这里函数返回直接就是一个元素(element)</span><br><span class="line">     * -子节点     节点(node)</span><br><span class="line">      * -----属性      (attribute获取内容, attributeNode获取属性对象)</span><br><span class="line">     * -----内容      (text)</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    // 读取svg图片</span><br><span class="line">    QFile file(<span class="string">&quot;../test.svg&quot;</span>);</span><br><span class="line">    // 打开文件</span><br><span class="line">    <span class="keyword">if</span>(!file.open(QFile::ReadOnly | QFile::Text)) &#123;</span><br><span class="line">        QMessageBox::information(nullptr, QString(<span class="string">&quot;title&quot;</span>),QString(<span class="string">&quot;open error!&quot;</span>));</span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    // 绑定文件</span><br><span class="line">    QString error;</span><br><span class="line">    int row = 0, column = 0;</span><br><span class="line">    <span class="keyword">if</span>(!svgCode.setContent(&amp;file, <span class="literal">false</span>, &amp;error, &amp;row, &amp;column)) &#123; //形参2，是否创建命名空间</span><br><span class="line">        QMessageBox::information(nullptr, QString(<span class="string">&quot;Error&quot;</span>),</span><br><span class="line">                                 QString(<span class="string">&quot;parse file failed at line row and column&quot;</span>) +</span><br><span class="line">                                 QString::number(row, 10) + QString(<span class="string">&quot;,&quot;</span>) +</span><br><span class="line">                                 QString::number(column, 10));</span><br><span class="line">        file.close();</span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    // 如果内容为空</span><br><span class="line">    <span class="keyword">if</span>(svgCode.isNull()) &#123;</span><br><span class="line">       QMessageBox::information(nullptr, QString(<span class="string">&quot;title&quot;</span>), QString(<span class="string">&quot;document is null!&quot;</span>));</span><br><span class="line">       file.close();</span><br><span class="line">       <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取根节点, 这里是svg</span><br><span class="line">    QDomElement root=svgCode.documentElement();</span><br><span class="line">    // root节点里是否含有属性<span class="string">&quot;xmlns&quot;</span></span><br><span class="line">    qDebug() &lt;&lt; <span class="string">root.nodeName() &lt;&lt; root</span>.hasAttribute(<span class="string">&quot;xmlns&quot;</span>) ;</span><br><span class="line">    // 打印该节点中含有<span class="string">&quot;xmlns&quot;</span>属性的值</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">root.attributeNode(&quot;xmlns&quot;).value();</span></span><br><span class="line"><span class="string">    // 获取第一个子节点</span></span><br><span class="line"><span class="string">    QDomNode node = root</span>.firstChild();</span><br><span class="line">    // 打印子节点的名字</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">node.nodeName();</span></span><br><span class="line"><span class="string">    // 注意节点要转换为Element才能得到其中value的值, 直接nodeValue是空的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 得到value的两种方法</span></span><br><span class="line"><span class="string">    // 1. attribute, 直接一字符串返回value</span></span><br><span class="line"><span class="string">    QString id = node</span>.toElement().attribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    // 2. attributeNode, 返回的是个QDomAttr对象(属性), 通过value再得到里面的值</span><br><span class="line">    <span class="built_in">id</span> = node.toElement().attributeNode(<span class="string">&quot;id&quot;</span>).value();</span><br><span class="line">    // 获取元素内的内容text</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">node.toElement().text();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 也可以来到子节点的下一个节点</span></span><br><span class="line"><span class="string">    node</span>.nextSibling();</span><br><span class="line"></span><br><span class="line">    // 获取了root的所有子节点, 即svg的所有子节点</span><br><span class="line">    QDomNodeList list = root.childNodes();</span><br><span class="line">    <span class="keyword">for</span> (int i = 0; i &lt; list.length(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        QDomNode node = list.at(i);</span><br><span class="line">        qDebug() &lt;&lt; <span class="string">node.nodeName();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 指针来到下一个节点, 这里是来到和root并行的下一个节点</span></span><br><span class="line"><span class="string">    QDomNode nextnode = root.nextSibling();</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h1 id="串口"><a href="#串口" class="headerlink" title="串口"></a>串口</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">导入模块 QT += serialport</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &quot;mainwidget.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;ui_mainwidget.h&quot;</span></span><br><span class="line"><span class="comment">#include &lt;QSerialPort&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QFileDialog&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QSerialPortInfo&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QMessageBox&gt;</span></span><br><span class="line"><span class="comment">#include &lt;QDebug&gt;</span></span><br><span class="line"><span class="comment">#define cout qDebug() &lt;&lt; &quot;[&quot; &lt;&lt; __FILE__ &lt;&lt; &quot;: &quot; &lt;&lt; __LINE__ &lt;&lt; &quot;]&quot;</span></span><br><span class="line"></span><br><span class="line">MainWidget::MainWidget(QWidget *parent) :</span><br><span class="line">    QWidget(parent),</span><br><span class="line">    ui(new Ui::MainWidget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(this);</span><br><span class="line">    file = new QFile(this);</span><br><span class="line"></span><br><span class="line">    // 获取可用的端口号，并传入QStringList</span><br><span class="line">    m_serialPortName  = getPortNameList();</span><br><span class="line">    cout &lt;&lt; <span class="string">m_serialPortName;</span></span><br><span class="line"><span class="string">//    加入所有的端口到下拉框</span></span><br><span class="line"><span class="string">    ui-&gt;comboBoxCom-&gt;addItems(m_serialPortName</span>);</span><br><span class="line">//    默认设置为第一个</span><br><span class="line">    ui-&gt;comboBoxCom-&gt;setCurrentIndex(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    m_serialPort = new QSerialPort();//实例化串口类一个对象</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_serialPort-&gt;isOpen())//如果串口已经打开了 先给他关闭了</span><br><span class="line">    &#123;</span><br><span class="line">        m_serialPort-&gt;clear();</span><br><span class="line">        m_serialPort-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //连接信号槽 当下位机发送数据</span><br><span class="line">    //QSerialPort 会发送个 readyRead 信号</span><br><span class="line">    //定义槽函数void receiveInfo()解析数据</span><br><span class="line">    connect(m_serialPort,&amp;QSerialPort::readyRead,this,&amp;MainWidget::receiveInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWidget::~<span class="function"><span class="title">MainWidget</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_serialPort-&gt;isOpen())</span><br><span class="line">    &#123;</span><br><span class="line">        m_serialPort-&gt;clear();</span><br><span class="line">        m_serialPort-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">    delete m_serialPort;</span><br><span class="line">    delete ui;</span><br><span class="line">&#125;</span><br><span class="line">// 获取所有可用的端口号</span><br><span class="line">QStringList MainWidget::<span class="function"><span class="title">getPortNameList</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    QStringList m_serialPortName;</span><br><span class="line">    foreach(const QSerialPortInfo &amp;info,QSerialPortInfo::availablePorts())</span><br><span class="line">    &#123;</span><br><span class="line">        m_serialPortName &lt;&lt; <span class="string">info.portName();</span></span><br><span class="line"><span class="string">        cout &lt;&lt; &quot;serialPortName:&quot; &lt;&lt; info</span>.portName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> m_serialPortName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理接受到的数据</span><br><span class="line">void MainWidget::<span class="function"><span class="title">receiveInfo</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    QByteArray info = m_serialPort-&gt;readAll();</span><br><span class="line">    QByteArray hexData = info.toHex();</span><br><span class="line">    //这里面的协议 你们自己定义就行  单片机发什么 代表什么 我们这里简单模拟一下</span><br><span class="line">    <span class="keyword">if</span>(hexData == <span class="string">&quot;0x10000&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        //do something</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(hexData  == <span class="string">&quot;0x100001&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        //do something</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//写两个函数 向单片机发送数据</span><br><span class="line">void MainWidget::sendInfo(char* info,int len)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;len; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%x\n&quot;</span>, info[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    m_serialPort-&gt;write(info,len);//这句是真正的给单片机发数据 用到的是QIODevice::write 具体可以看文档</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 发送信息</span><br><span class="line">void MainWidget::sendInfo(const QString &amp;info)</span><br><span class="line">&#123;</span><br><span class="line">    QByteArray sendBuf;</span><br><span class="line">//    <span class="keyword">if</span> (info.contains(<span class="string">&quot; &quot;</span>))</span><br><span class="line">//    &#123;</span><br><span class="line">//        info.replace(QString(<span class="string">&quot; &quot;</span>),QString(<span class="string">&quot;&quot;</span>));//我这里是把空格去掉，根据你们定的协议来</span><br><span class="line">//    &#125;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">&quot;Write to serial: &quot;</span>&lt;&lt;<span class="string">info;</span></span><br><span class="line"><span class="string">    convertStringToHex(info</span>, sendBuf); //把QString 转换 为 hex</span><br><span class="line"></span><br><span class="line">    m_serialPort-&gt;write(sendBuf);//这句是真正的给单片机发数据 用到的是QIODevice::write 具体可以看文档</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//基本和单片机交互 数据 都是16进制的 我们这里自己写一个 Qstring 转为 16进制的函数</span><br><span class="line">void MainWidget::convertStringToHex(const QString &amp;str, QByteArray &amp;byteData)</span><br><span class="line">&#123;</span><br><span class="line">    int hexdata,lowhexdata;</span><br><span class="line">    int hexdatalen = 0;</span><br><span class="line">    int len = str.length();</span><br><span class="line">    byteData.resize(len/2);</span><br><span class="line">    char lstr,hstr;</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;len; )</span><br><span class="line">    &#123;</span><br><span class="line">        //char lstr,</span><br><span class="line">        hstr=str[i].toLatin1();</span><br><span class="line">        <span class="keyword">if</span>(hstr == <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="built_in">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">if</span>(i &gt;= len)</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        lstr = str[i].toLatin1();</span><br><span class="line">        hexdata = convertCharToHex(hstr);</span><br><span class="line">        lowhexdata = convertCharToHex(lstr);</span><br><span class="line">        <span class="keyword">if</span>((hexdata == 16) || (lowhexdata == 16))</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hexdata = hexdata*16+lowhexdata;</span><br><span class="line">        i++;</span><br><span class="line">        byteData[hexdatalen] = (char)hexdata;</span><br><span class="line">        hexdatalen++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    byteData.resize(hexdatalen);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//另一个 函数 char 转为 16进制</span><br><span class="line">char MainWidget::convertCharToHex(char ch)</span><br><span class="line">&#123;</span><br><span class="line">    /*</span><br><span class="line">    0x30等于十进制的48，48也是0的ASCII值，，</span><br><span class="line">    1-9的ASCII值是49-57，，所以某一个值－0x30，，</span><br><span class="line">    就是将字符0-9转换为0-9</span><br><span class="line"></span><br><span class="line">    */</span><br><span class="line">    <span class="keyword">if</span>((ch &gt;= <span class="string">&#x27;0&#x27;</span>) &amp;&amp; (ch &lt;= <span class="string">&#x27;9&#x27;</span>))</span><br><span class="line">         <span class="built_in">return</span> ch-0x30;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>((ch &gt;= <span class="string">&#x27;A&#x27;</span>) &amp;&amp; (ch &lt;= <span class="string">&#x27;F&#x27;</span>))</span><br><span class="line">         <span class="built_in">return</span> ch-<span class="string">&#x27;A&#x27;</span>+10;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>((ch &gt;= <span class="string">&#x27;a&#x27;</span>) &amp;&amp; (ch &lt;= <span class="string">&#x27;f&#x27;</span>))</span><br><span class="line">         <span class="built_in">return</span> ch-<span class="string">&#x27;a&#x27;</span>+10;</span><br><span class="line">     <span class="keyword">else</span> <span class="built_in">return</span> (-1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::on_comboBoxCom_activated(int index)</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;com_index = index;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">com_index;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">void MainWidget::on_pushButtonLink_clicked()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    //设置串口名字</span></span><br><span class="line"><span class="string">    m_serialPort-&gt;setPortName(m_serialPortName[com_index</span>]);</span><br><span class="line">    cout &lt;&lt; <span class="string">m_serialPortName[com_index];</span></span><br><span class="line"><span class="string">    if(!m_serialPort-&gt;open(QIODevice::ReadWrite))//用ReadWrite 的模式尝试打开串口</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        QMessageBox::warning(this, &quot;警告&quot;, &quot;打开失败&quot;);</span></span><br><span class="line"><span class="string">        return;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //打开成功</span></span><br><span class="line"><span class="string">    QMessageBox::information(this, &quot;打开&quot;, &quot;打开成功&quot;);</span></span><br><span class="line"><span class="string">    ui-&gt;labelComText-&gt;setText(m_serialPortName</span>[com_index] + <span class="string">&quot;已成功连接&quot;</span>);</span><br><span class="line">    m_serialPort-&gt;setBaudRate(115200,QSerialPort::AllDirections);//设置波特率和读写方向</span><br><span class="line">    m_serialPort-&gt;setDataBits(QSerialPort::Data8);		//数据位为8位</span><br><span class="line">    m_serialPort-&gt;setFlowControl(QSerialPort::NoFlowControl);//无流控制</span><br><span class="line">    m_serialPort-&gt;setParity(QSerialPort::NoParity);	//无校验位</span><br><span class="line">    m_serialPort-&gt;setStopBits(QSerialPort::OneStop); //一位停止位</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_pushButtonDisconnect_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_serialPort-&gt;isOpen())</span><br><span class="line">    &#123;</span><br><span class="line">        m_serialPort-&gt;clear();</span><br><span class="line">        m_serialPort-&gt;close();</span><br><span class="line">        QMessageBox::information(this, <span class="string">&quot;关闭&quot;</span>, <span class="string">&quot;关闭成功&quot;</span>);</span><br><span class="line">        ui-&gt;labelComText-&gt;setText(<span class="string">&quot;未连接&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QMessageBox::warning(this, <span class="string">&quot;警告&quot;</span>, <span class="string">&quot;关闭失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_pushButtonChoose_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">   QString filepath = QFileDialog::getOpenFileName(this, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;../&quot;</span>);</span><br><span class="line">   <span class="keyword">if</span>(!filepath.isEmpty())</span><br><span class="line">   &#123;</span><br><span class="line">//       只读方式打开文件</span><br><span class="line">       file-&gt;setFileName(filepath);</span><br><span class="line">//       获取文件信息</span><br><span class="line">       QFileInfo fileinfo(filepath);</span><br><span class="line">       filename = fileinfo.fileName();</span><br><span class="line">       filesize = fileinfo.size();</span><br><span class="line">       sendsize = 0;   //发送文件的大小</span><br><span class="line">       <span class="keyword">if</span>(file-&gt;open(QIODevice::ReadOnly))</span><br><span class="line">       &#123;</span><br><span class="line">//           发送按钮亮起, 选择变灰</span><br><span class="line">           ui-&gt;pushButtonChoose-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">           ui-&gt;pushButtonSend-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void MainWidget::<span class="function"><span class="title">on_pushButtonSend_clicked</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    qint64 len = 0;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        //每次发送数据的大小</span><br><span class="line">        char buf[4*1024] = &#123;0&#125;;</span><br><span class="line">        len = 0;</span><br><span class="line">        //读取文件中的数据</span><br><span class="line">        len = file-&gt;<span class="built_in">read</span>(buf, sizeof (buf));</span><br><span class="line">        //返回已经写入的数据</span><br><span class="line">        len = m_serialPort-&gt;write(buf, len);</span><br><span class="line">        //积累的已经发送的文件数据</span><br><span class="line">        sendsize += len;</span><br><span class="line">    &#125; <span class="keyword">while</span>(len &gt; 0);   //只要写入的数据大于0, 就说明还没发完</span><br><span class="line">    //判断文件是否发送完成</span><br><span class="line">    <span class="keyword">if</span>(filesize == sendsize)</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::information(this, <span class="string">&quot;完成&quot;</span>, <span class="string">&quot;文件发送完毕&quot;</span>);</span><br><span class="line">        //关闭文件</span><br><span class="line">        file-&gt;close();</span><br><span class="line"></span><br><span class="line">        ui-&gt;pushButtonChoose-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;pushButtonSend-&gt;setEnabled(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">注意用QRegularExpression , 不要用QRegExp, 后者bug太多</span><br><span class="line"></span><br><span class="line">QRegularExpression separators(<span class="string">&quot;.(?=[A-Za-z])&quot;</span>);</span><br><span class="line">QStringList tokens = d.split(separators);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">��ɽ��</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/Qt-note/">http://example.com/Qt-note/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">ľ��ɿ�</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><a class="post-meta__tags" href="/tags/Qt/">Qt</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/07/19/UWJDW8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/git-used/"><img class="prev-cover" src="https://s1.ax1x.com/2020/07/19/UWJuZR.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">GIT使用笔记</div></div></a></div><div class="next-post pull-right"><a href="/experience/"><img class="next-cover" src="https://s1.ax1x.com/2020/06/11/tHrX3F.md.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">个人经历</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/ad-note/" title="AltiumDesigner学习"><img class="cover" src="http://yanxuan.nosdn.127.net/986042e56f5523fc4bff794e4b6c4586.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-30</div><div class="title">AltiumDesigner学习</div></div></a></div><div><a href="/autocad-note/" title="AutoCAD学习"><img class="cover" src="https://s1.ax1x.com/2020/11/10/BL2zDJ.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-03</div><div class="title">AutoCAD学习</div></div></a></div><div><a href="/c++note/" title="C++学习"><img class="cover" src="http://yanxuan.nosdn.127.net/27ad4240afb3fa07197eaec257022c89.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-03</div><div class="title">C++学习</div></div></a></div><div><a href="/git-used/" title="GIT使用笔记"><img class="cover" src="https://s1.ax1x.com/2020/07/19/UWJuZR.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-19</div><div class="title">GIT使用笔记</div></div></a></div><div><a href="/linux-note/" title="Linux学习"><img class="cover" src="http://yanxuan.nosdn.127.net/77fafe855fffa4e29aa30b56af8af642.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-03</div><div class="title">Linux学习</div></div></a></div><div><a href="/golang-note/" title="go语言学习"><img class="cover" src="http://yanxuan.nosdn.127.net/8f4f53c328ba7a1e1b8d98fb0129463a.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-09</div><div class="title">go语言学习</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">��ɽ��</div><div class="author-info__description">ľ��ɿɵĲ���</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#main%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.</span> <span class="toc-text">main函数模板</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B9%E4%BE%BF%E8%B0%83%E8%AF%95%E6%97%B6%E6%9F%A5%E7%9C%8B%E6%89%93%E5%8D%B0%E4%BF%A1%E6%81%AF%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">方便调试时查看打印信息的方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QWidget%E4%B8%8EQMainWindow"><span class="toc-number">3.</span> <span class="toc-text">QWidget与QMainWindow</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%93%E5%8C%85exe%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text">打包exe的方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BFexe%E6%96%87%E4%BB%B6%E6%9C%89%E5%9B%BE%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text">使exe文件有图标的方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8MainWidget%E4%BB%A5%E5%A4%96%E7%9A%84cpp%E4%B8%AD%E4%BD%BF%E7%94%A8ui%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">在MainWidget以外的cpp中使用ui的方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BDqss%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">加载qss资源文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%89%E9%92%AE"><span class="toc-number">8.</span> <span class="toc-text">按钮</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E4%B8%8E%E6%A7%BD"><span class="toc-number">9.</span> <span class="toc-text">信号与槽</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A7%BD"><span class="toc-number">10.</span> <span class="toc-text">自定义槽</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%A1%E5%8F%B7"><span class="toc-number">11.</span> <span class="toc-text">自定义信号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84%E4%BF%A1%E5%8F%B7"><span class="toc-number">12.</span> <span class="toc-text">带参数的信号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">13.</span> <span class="toc-text">lambda表达式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E7%B3%BB%E7%BB%9F"><span class="toc-number">14.</span> <span class="toc-text">坐标系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">15.</span> <span class="toc-text">内存回收机制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%95%8C%E9%9D%A2-%E8%8F%9C%E5%8D%95%E6%A0%8F-%E7%8A%B6%E6%80%81%E6%A0%8F-%E6%B5%AE%E5%8A%A8%E7%AA%97%E5%8F%A3%E7%AD%89%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">16.</span> <span class="toc-text">窗口界面, 菜单栏,状态栏, 浮动窗口等的编写</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E6%A0%8F"><span class="toc-number">16.1.</span> <span class="toc-text">菜单栏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E6%A0%8F-%E6%98%AF%E8%8F%9C%E5%8D%95%E9%A1%B9%E7%9A%84%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F"><span class="toc-number">16.2.</span> <span class="toc-text">工具栏, 是菜单项的快捷方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A0%8F"><span class="toc-number">16.3.</span> <span class="toc-text">状态栏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%8E%A7%E4%BB%B6-%E6%96%87%E6%9C%AC%E6%A1%86"><span class="toc-number">16.4.</span> <span class="toc-text">核心控件,文本框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%AE%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">16.5.</span> <span class="toc-text">浮动窗口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%B8%8E%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">17.</span> <span class="toc-text">模态对话框与非模态对话框</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Dialog%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">18.</span> <span class="toc-text">Dialog对话框</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%85%B3%E4%BA%8E%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">18.1.</span> <span class="toc-text">显示关于对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">18.2.</span> <span class="toc-text">显示问题对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">18.3.</span> <span class="toc-text">显示打开文件对话框</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8E%A7%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">19.</span> <span class="toc-text">常用控件的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6"><span class="toc-number">20.</span> <span class="toc-text">自定义控件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E4%BF%AE%E6%94%B9"><span class="toc-number">21.</span> <span class="toc-text">样式修改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">22.</span> <span class="toc-text">事件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84label%E6%8E%A7%E4%BB%B6"><span class="toc-number">23.</span> <span class="toc-text">自定义的label控件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E9%94%AE%E7%9B%98%E4%BA%8B%E4%BB%B6%E4%B8%8E%E5%AE%9A%E6%97%B6%E5%99%A8%E4%BA%8B%E4%BB%B6"><span class="toc-number">24.</span> <span class="toc-text">响应键盘事件与定时器事件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%8E%A5%E6%94%B6%E4%B8%8E%E5%BF%BD%E7%95%A5"><span class="toc-number">25.</span> <span class="toc-text">事件的接收与忽略</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#event%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">26.</span> <span class="toc-text">event函数的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">27.</span> <span class="toc-text">事件过滤器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">28.</span> <span class="toc-text">生成随机数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%98%E5%9B%BE"><span class="toc-number">29.</span> <span class="toc-text">绘图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E9%87%8D%E7%BB%98"><span class="toc-number">30.</span> <span class="toc-text">窗口重绘</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QPixmap%E4%B8%8EQBitmap"><span class="toc-number">31.</span> <span class="toc-text">QPixmap与QBitmap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%98%E5%9B%BE%E8%AE%BE%E5%A4%87"><span class="toc-number">32.</span> <span class="toc-text">绘图设备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#QPixmap"><span class="toc-number">32.1.</span> <span class="toc-text">QPixmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#QImage"><span class="toc-number">32.2.</span> <span class="toc-text">QImage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#QPicture"><span class="toc-number">32.3.</span> <span class="toc-text">QPicture</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QPixmap%E4%B8%8EQImage%E4%B9%8B%E9%97%B4%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2"><span class="toc-number">33.</span> <span class="toc-text">QPixmap与QImage之间的相互转换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8D%E8%A7%84%E5%88%99%E7%AA%97%E5%8F%A3"><span class="toc-number">34.</span> <span class="toc-text">不规则窗口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Qstring%E4%B8%8EQByteArray%E5%92%8Cchar-%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">35.</span> <span class="toc-text">Qstring与QByteArray和char *之间的转换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QFile%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5"><span class="toc-number">36.</span> <span class="toc-text">QFile文件的读取和写入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">37.</span> <span class="toc-text">获取文件信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QDataStream%E6%95%B0%E6%8D%AE%E6%B5%81%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6"><span class="toc-number">38.</span> <span class="toc-text">QDataStream数据流操作文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QTextStream%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6"><span class="toc-number">39.</span> <span class="toc-text">QTextStream操作文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QBuffer%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">40.</span> <span class="toc-text">QBuffer缓冲区</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP"><span class="toc-number">41.</span> <span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#server%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF"><span class="toc-number">41.1.</span> <span class="toc-text">server服务器端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#client%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">41.2.</span> <span class="toc-text">client客户端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UDP"><span class="toc-number">42.</span> <span class="toc-text">UDP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QTImer%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">43.</span> <span class="toc-text">QTImer定时器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B"><span class="toc-number">44.</span> <span class="toc-text">线程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">44.1.</span> <span class="toc-text">老方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E6%96%B9%E6%B3%95"><span class="toc-number">44.2.</span> <span class="toc-text">新方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%87%BD%E6%95%B0%E5%86%85%E9%83%A8-%E4%B8%8D%E5%85%81%E8%AE%B8%E5%A4%84%E7%90%86%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">45.</span> <span class="toc-text">线程函数内部, 不允许处理图形界面操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#conne%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">46.</span> <span class="toc-text">conne第五个参数的作用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-QMYSQL"><span class="toc-number">47.</span> <span class="toc-text">数据库操作: QMYSQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-SQLITE"><span class="toc-number">48.</span> <span class="toc-text">数据库操作: SQLITE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%AF%E8%A7%86%E5%8C%96%E6%93%8D%E4%BD%9C-QSqlTableModel"><span class="toc-number">49.</span> <span class="toc-text">数据库可视化操作:QSqlTableModel</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XML"><span class="toc-number">50.</span> <span class="toc-text">XML</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3"><span class="toc-number">51.</span> <span class="toc-text">串口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E5%88%99"><span class="toc-number">52.</span> <span class="toc-text">正则</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/undefined/" title="Hello World"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/undefined/" title="Hello World">Hello World</a><time datetime="2022-04-14T13:06:00.623Z" title="发表于 2022-04-14 21:06:00">2022-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/qt-with-opencv/" title="Qt配置opencv环境"><img src="https://s1.ax1x.com/2020/08/02/ate2E6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Qt配置opencv环境"/></a><div class="content"><a class="title" href="/qt-with-opencv/" title="Qt配置opencv环境">Qt配置opencv环境</a><time datetime="2020-08-02T10:22:51.000Z" title="发表于 2020-08-02 18:22:51">2020-08-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/git-used/" title="GIT使用笔记"><img src="https://s1.ax1x.com/2020/07/19/UWJuZR.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GIT使用笔记"/></a><div class="content"><a class="title" href="/git-used/" title="GIT使用笔记">GIT使用笔记</a><time datetime="2020-07-19T10:29:59.000Z" title="发表于 2020-07-19 18:29:59">2020-07-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Qt-note/" title="Qt学习笔记"><img src="https://s1.ax1x.com/2020/07/19/UWJDW8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Qt学习笔记"/></a><div class="content"><a class="title" href="/Qt-note/" title="Qt学习笔记">Qt学习笔记</a><time datetime="2020-07-19T09:38:50.000Z" title="发表于 2020-07-19 17:38:50">2020-07-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/experience/" title="个人经历"><img src="https://s1.ax1x.com/2020/06/11/tHrX3F.md.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="个人经历"/></a><div class="content"><a class="title" href="/experience/" title="个人经历">个人经历</a><time datetime="2020-06-11T05:14:36.000Z" title="发表于 2020-06-11 13:14:36">2020-06-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By ��ɽ��</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>